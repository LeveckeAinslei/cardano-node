<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstrainedClassMethods #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DefaultSignatures #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE UndecidableSuperClasses #-}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-comment">-- | Besides capturing all configuration that is necessary to progress to a specific era,</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- this interface also provides fast forward functionality that is used in testing and</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- benchmarking in order to initilize a chain in a particular era without going through</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- the trouble of generating all the history for preceeding eras.</span><span>
</span><span id="line-20"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Ledger.Shelley.Transition</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#EraTransition"><span class="hs-identifier">EraTransition</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#mkShelleyTransitionConfig"><span class="hs-identifier">mkShelleyTransitionConfig</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#tcInitialFundsL"><span class="hs-identifier">tcInitialFundsL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#tcInitialStakingL"><span class="hs-identifier">tcInitialStakingL</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#createInitialState"><span class="hs-identifier">createInitialState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#registerInitialFunds"><span class="hs-identifier">registerInitialFunds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#registerInitialStaking"><span class="hs-identifier">registerInitialStaking</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#toShelleyTransitionConfigPairs"><span class="hs-identifier">toShelleyTransitionConfigPairs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Address</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.BaseTypes</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.CertState</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Coin</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Core</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Credential</span></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Crypto</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.EpochBoundary</span></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Keys</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.PoolDistr</span></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html"><span class="hs-identifier">Cardano.Ledger.Shelley.Era</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Genesis.html"><span class="hs-identifier">Cardano.Ledger.Shelley.Genesis</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Governance.html"><span class="hs-identifier">Cardano.Ledger.Shelley.Governance</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.html"><span class="hs-identifier">Cardano.Ledger.Shelley.LedgerState</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Translation.html"><span class="hs-identifier">Cardano.Ledger.Shelley.Translation</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Translation.html#FromByronTranslationContext"><span class="hs-identifier">FromByronTranslationContext</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Translation.html#toFromByronTranslationContext"><span class="hs-identifier">toFromByronTranslationContext</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.UMap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">UM</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.UTxO</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Val</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FromJSON</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">KeyValue</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">object</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">pairs</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">withObject</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.:)</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Default.Class</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Kind.html"><span class="hs-identifier">Data.Kind</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ListMap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LM</span></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.ListMap</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ListMap</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Void.html"><span class="hs-identifier">Data.Void</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Void"><span class="hs-identifier">Void</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Generics.html"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.html"><span class="hs-identifier">GHC.Stack</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Lens.Micro</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">NoThunks.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NoThunks</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">class</span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EraTxOut</span></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Governance.html#EraGov"><span class="hs-identifier hs-type">EraGov</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Default</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#StashedAVVMAddresses"><span class="hs-identifier hs-type">StashedAVVMAddresses</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-71"></span><span>  </span><span id="EraTransition"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#EraTransition"><span class="hs-identifier hs-var">EraTransition</span></a></span></span><span> </span><span id="local-6989586621679615867"><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-72"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-comment">-- | Cumulative configuration that is needed to be able to start in a current era</span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-keyword">data</span><span> </span><span id="TransitionConfig"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-var">TransitionConfig</span></a></span></span><span> </span><span id="local-6989586621679615867"><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span>  </span><span id="mkTransitionConfig"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#mkTransitionConfig"><span class="hs-identifier hs-type">mkTransitionConfig</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-comment">-- | Translation context necessary for advancing from previous era into the current</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-comment">-- one. This will usually be the contents of genesis file, if one exists for the</span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-comment">-- current era</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">TranslationContext</span></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Transition configuration for the previous era.</span></span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PreviousEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-comment">-- | In case when a previous era is available, we should always be able to access</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-comment">-- `TransitionConfig` for the previous era, from within the current era's</span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-comment">-- `TransitionConfig`</span><span>
</span><span id="line-88"></span><span>  </span><span id="tcPreviousEraConfigL"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#tcPreviousEraConfigL"><span class="hs-identifier hs-type">tcPreviousEraConfigL</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-89"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#EraTransition"><span class="hs-identifier hs-type">EraTransition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PreviousEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-90"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PreviousEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span>  </span><span class="hs-comment">-- | Lens for the `TranslationContext` for the current era from the `TransitionConfig`</span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-comment">-- Translation context is a different name for the Genesis type for each era, they are</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-comment">-- one and the same concept.</span><span>
</span><span id="line-95"></span><span>  </span><span id="tcTranslationContextL"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#tcTranslationContextL"><span class="hs-identifier hs-type">tcTranslationContextL</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-96"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TranslationContext</span></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-comment">-- | Lens for the `ShelleyGenesis` from the `TransitionConfig`. Default implementation</span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-comment">-- looks in the previous era's config</span><span>
</span><span id="line-100"></span><span>  </span><span id="tcShelleyGenesisL"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#tcShelleyGenesisL"><span class="hs-identifier hs-type">tcShelleyGenesisL</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Genesis.html#ShelleyGenesis"><span class="hs-identifier hs-type">ShelleyGenesis</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EraCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>  </span><span class="hs-keyword">default</span><span> </span><span id="tcShelleyGenesisL"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#tcShelleyGenesisL"><span class="hs-identifier hs-type">tcShelleyGenesisL</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#EraTransition"><span class="hs-identifier hs-type">EraTransition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PreviousEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EraCrypto</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PreviousEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#~"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">EraCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-103"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Genesis.html#ShelleyGenesis"><span class="hs-identifier hs-type">ShelleyGenesis</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EraCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>  </span><span id="local-6989586621679616163"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#tcShelleyGenesisL"><span class="hs-identifier hs-var hs-var">tcShelleyGenesisL</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TransitionConfig (PreviousEra era)
 -&gt; f (TransitionConfig (PreviousEra era)))
-&gt; TransitionConfig era -&gt; f (TransitionConfig era)
forall era.
(EraTransition era, EraTransition (PreviousEra era)) =&gt;
Lens' (TransitionConfig era) (TransitionConfig (PreviousEra era))
Lens' (TransitionConfig era) (TransitionConfig (PreviousEra era))
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcPreviousEraConfigL"><span class="hs-identifier hs-var">tcPreviousEraConfigL</span></a></span><span> </span><span class="annot"><span class="annottext">((TransitionConfig (PreviousEra era)
  -&gt; f (TransitionConfig (PreviousEra era)))
 -&gt; TransitionConfig era -&gt; f (TransitionConfig era))
-&gt; ((ShelleyGenesis (EraCrypto era)
     -&gt; f (ShelleyGenesis (EraCrypto era)))
    -&gt; TransitionConfig (PreviousEra era)
    -&gt; f (TransitionConfig (PreviousEra era)))
-&gt; (ShelleyGenesis (EraCrypto era)
    -&gt; f (ShelleyGenesis (EraCrypto era)))
-&gt; TransitionConfig era
-&gt; f (TransitionConfig era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ShelleyGenesis (EraCrypto era)
 -&gt; f (ShelleyGenesis (EraCrypto era)))
-&gt; TransitionConfig (PreviousEra era)
-&gt; f (TransitionConfig (PreviousEra era))
(ShelleyGenesis (EraCrypto (PreviousEra era))
 -&gt; f (ShelleyGenesis (EraCrypto (PreviousEra era))))
-&gt; TransitionConfig (PreviousEra era)
-&gt; f (TransitionConfig (PreviousEra era))
forall era.
EraTransition era =&gt;
Lens' (TransitionConfig era) (ShelleyGenesis (EraCrypto era))
Lens'
  (TransitionConfig (PreviousEra era))
  (ShelleyGenesis (EraCrypto (PreviousEra era)))
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcShelleyGenesisL"><span class="hs-identifier hs-var">tcShelleyGenesisL</span></a></span></span><span>
</span><span id="line-105"></span><span>
</span><span id="line-106"></span><span>  </span><span class="hs-comment">-- | Get the initial PParams for the current era from the `TransitionConfig`. Note that</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-comment">-- this is only useful for testing and fast forward functionality, because this function</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-comment">-- assumes no on-chain changes to PParams through PParamsUpdate functionality.</span><span>
</span><span id="line-109"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-110"></span><span>  </span><span class="hs-comment">-- Default implementation will use the PParams from the Previous era and the current</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-comment">-- `TranslationContext` to construct PParams for the current era.</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-comment">-- /Warning/ - Should only be used in testing and benchmarking</span><span>
</span><span id="line-114"></span><span>  </span><span id="tcInitialPParamsG"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#tcInitialPParamsG"><span class="hs-identifier hs-type">tcInitialPParamsG</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SimpleGetter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PParams</span></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-keyword">default</span><span> </span><span id="tcInitialPParamsG"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#tcInitialPParamsG"><span class="hs-identifier hs-type">tcInitialPParamsG</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#EraTransition"><span class="hs-identifier hs-type">EraTransition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PreviousEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TranslateEra</span></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PParams</span></span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TranslationError</span></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PParams</span></span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#~"><span class="hs-operator hs-type">~</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#Void"><span class="hs-identifier hs-type">Void</span></a></span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-120"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">SimpleGetter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PParams</span></span><span> </span><span class="annot"><a href="#local-6989586621679615867"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>  </span><span id="local-6989586621679616175"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#tcInitialPParamsG"><span class="hs-identifier hs-var hs-var">tcInitialPParamsG</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><span class="annottext">(TransitionConfig era -&gt; PParams era)
-&gt; SimpleGetter (TransitionConfig era) (PParams era)
forall s a. (s -&gt; a) -&gt; SimpleGetter s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="annot"><span class="annottext">((TransitionConfig era -&gt; PParams era)
 -&gt; SimpleGetter (TransitionConfig era) (PParams era))
-&gt; (TransitionConfig era -&gt; PParams era)
-&gt; SimpleGetter (TransitionConfig era) (PParams era)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679616191"><span class="annot"><span class="annottext">TransitionConfig era
</span><a href="#local-6989586621679616191"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-123"></span><span>      </span><span class="annot"><span class="annottext">TranslationContext era -&gt; PParams (PreviousEra era) -&gt; PParams era
forall era (f :: * -&gt; *).
(TranslateEra era f, TranslationError era f ~ Void) =&gt;
TranslationContext era -&gt; f (PreviousEra era) -&gt; f era
</span><span class="hs-identifier hs-var">translateEra'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransitionConfig era
</span><a href="#local-6989586621679616191"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TransitionConfig era
-&gt; Getting
     (TranslationContext era)
     (TransitionConfig era)
     (TranslationContext era)
-&gt; TranslationContext era
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (TranslationContext era)
  (TransitionConfig era)
  (TranslationContext era)
forall era.
EraTransition era =&gt;
Lens' (TransitionConfig era) (TranslationContext era)
Lens' (TransitionConfig era) (TranslationContext era)
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcTranslationContextL"><span class="hs-identifier hs-var">tcTranslationContextL</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransitionConfig era
</span><a href="#local-6989586621679616191"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TransitionConfig era
-&gt; Getting
     (PParams (PreviousEra era))
     (TransitionConfig era)
     (PParams (PreviousEra era))
-&gt; PParams (PreviousEra era)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">(TransitionConfig (PreviousEra era)
 -&gt; Const
      (PParams (PreviousEra era)) (TransitionConfig (PreviousEra era)))
-&gt; TransitionConfig era
-&gt; Const (PParams (PreviousEra era)) (TransitionConfig era)
forall era.
(EraTransition era, EraTransition (PreviousEra era)) =&gt;
Lens' (TransitionConfig era) (TransitionConfig (PreviousEra era))
Lens' (TransitionConfig era) (TransitionConfig (PreviousEra era))
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcPreviousEraConfigL"><span class="hs-identifier hs-var">tcPreviousEraConfigL</span></a></span><span> </span><span class="annot"><span class="annottext">((TransitionConfig (PreviousEra era)
  -&gt; Const
       (PParams (PreviousEra era)) (TransitionConfig (PreviousEra era)))
 -&gt; TransitionConfig era
 -&gt; Const (PParams (PreviousEra era)) (TransitionConfig era))
-&gt; ((PParams (PreviousEra era)
     -&gt; Const (PParams (PreviousEra era)) (PParams (PreviousEra era)))
    -&gt; TransitionConfig (PreviousEra era)
    -&gt; Const
         (PParams (PreviousEra era)) (TransitionConfig (PreviousEra era)))
-&gt; Getting
     (PParams (PreviousEra era))
     (TransitionConfig era)
     (PParams (PreviousEra era))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(PParams (PreviousEra era)
 -&gt; Const (PParams (PreviousEra era)) (PParams (PreviousEra era)))
-&gt; TransitionConfig (PreviousEra era)
-&gt; Const
     (PParams (PreviousEra era)) (TransitionConfig (PreviousEra era))
forall era.
EraTransition era =&gt;
SimpleGetter (TransitionConfig era) (PParams era)
SimpleGetter
  (TransitionConfig (PreviousEra era)) (PParams (PreviousEra era))
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcInitialPParamsG"><span class="hs-identifier hs-var">tcInitialPParamsG</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679615910"><span class="annot"><span class="hs-identifier hs-type">Crypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679615910"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#EraTransition"><span class="hs-identifier hs-type">EraTransition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyEra"><span class="hs-identifier hs-type">ShelleyEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615910"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-keyword">newtype</span><span> </span><span id="TransitionConfig"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-var">TransitionConfig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyEra"><span class="hs-identifier hs-type">ShelleyEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615910"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ShelleyTransitionConfig"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#ShelleyTransitionConfig"><span class="hs-identifier hs-var">ShelleyTransitionConfig</span></a></span></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="stcShelleyGenesis"><span class="annot"><span class="annottext">forall c. TransitionConfig (ShelleyEra c) -&gt; ShelleyGenesis c
</span><a href="Cardano.Ledger.Shelley.Transition.html#stcShelleyGenesis"><span class="hs-identifier hs-var hs-var">stcShelleyGenesis</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Genesis.html#ShelleyGenesis"><span class="hs-identifier hs-type">ShelleyGenesis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615910"><span class="hs-identifier hs-type">c</span></a></span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679616222"><span id="local-6989586621679616227"><span class="annot"><span class="annottext">TransitionConfig (ShelleyEra c)
-&gt; TransitionConfig (ShelleyEra c) -&gt; Bool
(TransitionConfig (ShelleyEra c)
 -&gt; TransitionConfig (ShelleyEra c) -&gt; Bool)
-&gt; (TransitionConfig (ShelleyEra c)
    -&gt; TransitionConfig (ShelleyEra c) -&gt; Bool)
-&gt; Eq (TransitionConfig (ShelleyEra c))
forall c.
Crypto c =&gt;
TransitionConfig (ShelleyEra c)
-&gt; TransitionConfig (ShelleyEra c) -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall c.
Crypto c =&gt;
TransitionConfig (ShelleyEra c)
-&gt; TransitionConfig (ShelleyEra c) -&gt; Bool
== :: TransitionConfig (ShelleyEra c)
-&gt; TransitionConfig (ShelleyEra c) -&gt; Bool
$c/= :: forall c.
Crypto c =&gt;
TransitionConfig (ShelleyEra c)
-&gt; TransitionConfig (ShelleyEra c) -&gt; Bool
/= :: TransitionConfig (ShelleyEra c)
-&gt; TransitionConfig (ShelleyEra c) -&gt; Bool
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679616234"><span id="local-6989586621679616240"><span id="local-6989586621679616244"><span class="annot"><span class="annottext">Int -&gt; TransitionConfig (ShelleyEra c) -&gt; ShowS
[TransitionConfig (ShelleyEra c)] -&gt; ShowS
TransitionConfig (ShelleyEra c) -&gt; String
(Int -&gt; TransitionConfig (ShelleyEra c) -&gt; ShowS)
-&gt; (TransitionConfig (ShelleyEra c) -&gt; String)
-&gt; ([TransitionConfig (ShelleyEra c)] -&gt; ShowS)
-&gt; Show (TransitionConfig (ShelleyEra c))
forall c.
Crypto c =&gt;
Int -&gt; TransitionConfig (ShelleyEra c) -&gt; ShowS
forall c. Crypto c =&gt; [TransitionConfig (ShelleyEra c)] -&gt; ShowS
forall c. Crypto c =&gt; TransitionConfig (ShelleyEra c) -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall c.
Crypto c =&gt;
Int -&gt; TransitionConfig (ShelleyEra c) -&gt; ShowS
showsPrec :: Int -&gt; TransitionConfig (ShelleyEra c) -&gt; ShowS
$cshow :: forall c. Crypto c =&gt; TransitionConfig (ShelleyEra c) -&gt; String
show :: TransitionConfig (ShelleyEra c) -&gt; String
$cshowList :: forall c. Crypto c =&gt; [TransitionConfig (ShelleyEra c)] -&gt; ShowS
showList :: [TransitionConfig (ShelleyEra c)] -&gt; ShowS
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679616248"><span id="local-6989586621679616250"><span class="annot"><span class="annottext">(forall x.
 TransitionConfig (ShelleyEra c)
 -&gt; Rep (TransitionConfig (ShelleyEra c)) x)
-&gt; (forall x.
    Rep (TransitionConfig (ShelleyEra c)) x
    -&gt; TransitionConfig (ShelleyEra c))
-&gt; Generic (TransitionConfig (ShelleyEra c))
forall x.
Rep (TransitionConfig (ShelleyEra c)) x
-&gt; TransitionConfig (ShelleyEra c)
forall x.
TransitionConfig (ShelleyEra c)
-&gt; Rep (TransitionConfig (ShelleyEra c)) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall c x.
Rep (TransitionConfig (ShelleyEra c)) x
-&gt; TransitionConfig (ShelleyEra c)
forall c x.
TransitionConfig (ShelleyEra c)
-&gt; Rep (TransitionConfig (ShelleyEra c)) x
$cfrom :: forall c x.
TransitionConfig (ShelleyEra c)
-&gt; Rep (TransitionConfig (ShelleyEra c)) x
from :: forall x.
TransitionConfig (ShelleyEra c)
-&gt; Rep (TransitionConfig (ShelleyEra c)) x
$cto :: forall c x.
Rep (TransitionConfig (ShelleyEra c)) x
-&gt; TransitionConfig (ShelleyEra c)
to :: forall x.
Rep (TransitionConfig (ShelleyEra c)) x
-&gt; TransitionConfig (ShelleyEra c)
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span>  </span><span id="local-6989586621679616255"><span class="annot"><span class="annottext">mkTransitionConfig :: TranslationContext (ShelleyEra c)
-&gt; TransitionConfig (PreviousEra (ShelleyEra c))
-&gt; TransitionConfig (ShelleyEra c)
</span><a href="Cardano.Ledger.Shelley.Transition.html#mkTransitionConfig"><span class="hs-identifier hs-var hs-var hs-var hs-var">mkTransitionConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><span class="annottext">String
-&gt; FromByronTranslationContext c
-&gt; TransitionConfig (ByronEra c)
-&gt; TransitionConfig (ShelleyEra c)
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Impossible: There is no EraTransition instance for ByronEra&quot;</span></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>  </span><span id="local-6989586621679616262"><span class="annot"><span class="annottext">tcPreviousEraConfigL :: EraTransition (PreviousEra (ShelleyEra c)) =&gt;
Lens'
  (TransitionConfig (ShelleyEra c))
  (TransitionConfig (PreviousEra (ShelleyEra c)))
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcPreviousEraConfigL"><span class="hs-identifier hs-var hs-var hs-var hs-var">tcPreviousEraConfigL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TransitionConfig (ByronEra c)
 -&gt; f (TransitionConfig (ByronEra c)))
-&gt; TransitionConfig (ShelleyEra c)
-&gt; f (TransitionConfig (ShelleyEra c))
(TransitionConfig (PreviousEra (ShelleyEra c))
 -&gt; f (TransitionConfig (PreviousEra (ShelleyEra c))))
-&gt; TransitionConfig (ShelleyEra c)
-&gt; f (TransitionConfig (ShelleyEra c))
forall a b. HasCallStack =&gt; Lens' a b
Lens'
  (TransitionConfig (ShelleyEra c)) (TransitionConfig (ByronEra c))
</span><span class="hs-identifier hs-var">notSupportedInThisEraL</span></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span>  </span><span id="local-6989586621679616268"><span class="annot"><span class="annottext">tcTranslationContextL :: Lens'
  (TransitionConfig (ShelleyEra c))
  (TranslationContext (ShelleyEra c))
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcTranslationContextL"><span class="hs-identifier hs-var hs-var hs-var hs-var">tcTranslationContextL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-137"></span><span>    </span><span class="annot"><span class="annottext">(ShelleyGenesis c -&gt; f (ShelleyGenesis c))
-&gt; TransitionConfig (ShelleyEra c)
-&gt; f (TransitionConfig (ShelleyEra c))
(ShelleyGenesis (EraCrypto (ShelleyEra c))
 -&gt; f (ShelleyGenesis (EraCrypto (ShelleyEra c))))
-&gt; TransitionConfig (ShelleyEra c)
-&gt; f (TransitionConfig (ShelleyEra c))
forall era.
EraTransition era =&gt;
Lens' (TransitionConfig era) (ShelleyGenesis (EraCrypto era))
Lens'
  (TransitionConfig (ShelleyEra c))
  (ShelleyGenesis (EraCrypto (ShelleyEra c)))
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcShelleyGenesisL"><span class="hs-identifier hs-var">tcShelleyGenesisL</span></a></span><span> </span><span class="annot"><span class="annottext">((ShelleyGenesis c -&gt; f (ShelleyGenesis c))
 -&gt; TransitionConfig (ShelleyEra c)
 -&gt; f (TransitionConfig (ShelleyEra c)))
-&gt; ((FromByronTranslationContext c
     -&gt; f (FromByronTranslationContext c))
    -&gt; ShelleyGenesis c -&gt; f (ShelleyGenesis c))
-&gt; (FromByronTranslationContext c
    -&gt; f (FromByronTranslationContext c))
-&gt; TransitionConfig (ShelleyEra c)
-&gt; f (TransitionConfig (ShelleyEra c))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ShelleyGenesis c -&gt; FromByronTranslationContext c)
-&gt; (ShelleyGenesis c
    -&gt; FromByronTranslationContext c -&gt; ShelleyGenesis c)
-&gt; Lens
     (ShelleyGenesis c)
     (ShelleyGenesis c)
     (FromByronTranslationContext c)
     (FromByronTranslationContext c)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><span class="hs-identifier hs-var">lens</span></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis c -&gt; FromByronTranslationContext c
forall c. ShelleyGenesis c -&gt; FromByronTranslationContext c
</span><a href="Cardano.Ledger.Shelley.Translation.html#toFromByronTranslationContext"><span class="hs-identifier hs-var">toFromByronTranslationContext</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis c
-&gt; FromByronTranslationContext c -&gt; ShelleyGenesis c
forall {c}.
ShelleyGenesis c
-&gt; FromByronTranslationContext c -&gt; ShelleyGenesis c
</span><a href="#local-6989586621679616270"><span class="hs-identifier hs-var">setFBTC</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-139"></span><span>      </span><span id="local-6989586621679616270"><span class="annot"><span class="annottext">setFBTC :: ShelleyGenesis c
-&gt; FromByronTranslationContext c -&gt; ShelleyGenesis c
</span><a href="#local-6989586621679616270"><span class="hs-identifier hs-var hs-var">setFBTC</span></a></span></span><span> </span><span id="local-6989586621679616271"><span class="annot"><span class="annottext">ShelleyGenesis c
</span><a href="#local-6989586621679616271"><span class="hs-identifier hs-var">shelleyGenesis</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Translation.html#FromByronTranslationContext"><span class="hs-identifier hs-type">FromByronTranslationContext</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679616273"><span id="local-6989586621679616274"><span id="local-6989586621679616275"><span class="annot"><span class="annottext">Word64
Map (KeyHash 'Genesis c) (GenDelegPair c)
PParams (ShelleyEra c)
fbtcGenDelegs :: Map (KeyHash 'Genesis c) (GenDelegPair c)
fbtcProtocolParams :: PParams (ShelleyEra c)
fbtcMaxLovelaceSupply :: Word64
fbtcGenDelegs :: forall c.
FromByronTranslationContext c
-&gt; Map (KeyHash 'Genesis c) (GenDelegPair c)
fbtcProtocolParams :: forall c. FromByronTranslationContext c -&gt; PParams (ShelleyEra c)
fbtcMaxLovelaceSupply :: forall c. FromByronTranslationContext c -&gt; Word64
</span><a href="#local-6989586621679616273"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-140"></span><span>        </span><span class="annot"><span class="annottext">ShelleyGenesis c
</span><a href="#local-6989586621679616271"><span class="hs-identifier hs-var">shelleyGenesis</span></a></span><span>
</span><span id="line-141"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Genesis.html#sgGenDelegs"><span class="hs-identifier hs-var">sgGenDelegs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679616273"><span class="hs-identifier hs-type">fbtcGenDelegs</span></a></span><span>
</span><span id="line-142"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Genesis.html#sgProtocolParams"><span class="hs-identifier hs-var">sgProtocolParams</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679616274"><span class="hs-identifier hs-type">fbtcProtocolParams</span></a></span><span>
</span><span id="line-143"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Genesis.html#sgMaxLovelaceSupply"><span class="hs-identifier hs-var">sgMaxLovelaceSupply</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679616275"><span class="hs-identifier hs-type">fbtcMaxLovelaceSupply</span></a></span><span>
</span><span id="line-144"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span>  </span><span id="local-6989586621679616284"><span class="annot"><span class="annottext">tcShelleyGenesisL :: Lens'
  (TransitionConfig (ShelleyEra c))
  (ShelleyGenesis (EraCrypto (ShelleyEra c)))
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcShelleyGenesisL"><span class="hs-identifier hs-var hs-var hs-var hs-var">tcShelleyGenesisL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TransitionConfig (ShelleyEra c) -&gt; ShelleyGenesis c)
-&gt; (TransitionConfig (ShelleyEra c)
    -&gt; ShelleyGenesis c -&gt; TransitionConfig (ShelleyEra c))
-&gt; Lens
     (TransitionConfig (ShelleyEra c))
     (TransitionConfig (ShelleyEra c))
     (ShelleyGenesis c)
     (ShelleyGenesis c)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><span class="hs-identifier hs-var">lens</span></span><span> </span><span class="annot"><span class="annottext">TransitionConfig (ShelleyEra c) -&gt; ShelleyGenesis c
forall c. TransitionConfig (ShelleyEra c) -&gt; ShelleyGenesis c
</span><a href="Cardano.Ledger.Shelley.Transition.html#stcShelleyGenesis"><span class="hs-identifier hs-var">stcShelleyGenesis</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679616285"><span class="annot"><span class="annottext">TransitionConfig (ShelleyEra c)
</span><a href="#local-6989586621679616285"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621679616286"><span class="annot"><span class="annottext">ShelleyGenesis c
</span><a href="#local-6989586621679616286"><span class="hs-identifier hs-var">sg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TransitionConfig (ShelleyEra c)
</span><a href="#local-6989586621679616285"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#stcShelleyGenesis"><span class="hs-identifier hs-var">stcShelleyGenesis</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679616286"><span class="hs-identifier hs-type">sg</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>
</span><span id="line-148"></span><span>  </span><span id="local-6989586621679616287"><span class="annot"><span class="annottext">tcInitialPParamsG :: SimpleGetter
  (TransitionConfig (ShelleyEra c)) (PParams (ShelleyEra c))
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcInitialPParamsG"><span class="hs-identifier hs-var hs-var hs-var hs-var">tcInitialPParamsG</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TransitionConfig (ShelleyEra c) -&gt; PParams (ShelleyEra c))
-&gt; SimpleGetter
     (TransitionConfig (ShelleyEra c)) (PParams (ShelleyEra c))
forall s a. (s -&gt; a) -&gt; SimpleGetter s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyGenesis c -&gt; PParams (ShelleyEra c)
forall c. ShelleyGenesis c -&gt; PParams (ShelleyEra c)
</span><a href="Cardano.Ledger.Shelley.Genesis.html#sgProtocolParams"><span class="hs-identifier hs-var">sgProtocolParams</span></a></span><span> </span><span class="annot"><span class="annottext">(ShelleyGenesis c -&gt; PParams (ShelleyEra c))
-&gt; (TransitionConfig (ShelleyEra c) -&gt; ShelleyGenesis c)
-&gt; TransitionConfig (ShelleyEra c)
-&gt; PParams (ShelleyEra c)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TransitionConfig (ShelleyEra c) -&gt; ShelleyGenesis c
forall c. TransitionConfig (ShelleyEra c) -&gt; ShelleyGenesis c
</span><a href="Cardano.Ledger.Shelley.Transition.html#stcShelleyGenesis"><span class="hs-identifier hs-var">stcShelleyGenesis</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="annot"><span class="hs-comment">-- | Constructor for the base Shelley `TransitionConfig`</span></span><span>
</span><span id="line-151"></span><span id="local-6989586621679615954"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#mkShelleyTransitionConfig"><span class="hs-identifier hs-type">mkShelleyTransitionConfig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Genesis.html#ShelleyGenesis"><span class="hs-identifier hs-type">ShelleyGenesis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615954"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyEra"><span class="hs-identifier hs-type">ShelleyEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615954"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-152"></span><span id="mkShelleyTransitionConfig"><span class="annot"><span class="annottext">mkShelleyTransitionConfig :: forall c. ShelleyGenesis c -&gt; TransitionConfig (ShelleyEra c)
</span><a href="Cardano.Ledger.Shelley.Transition.html#mkShelleyTransitionConfig"><span class="hs-identifier hs-var hs-var">mkShelleyTransitionConfig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis c -&gt; TransitionConfig (ShelleyEra c)
forall c. ShelleyGenesis c -&gt; TransitionConfig (ShelleyEra c)
</span><a href="Cardano.Ledger.Shelley.Transition.html#ShelleyTransitionConfig"><span class="hs-identifier hs-var">ShelleyTransitionConfig</span></a></span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- | Get the initial funds from the `TransitionConfig`. This value must be non-empty</span><span>
</span><span id="line-155"></span><span class="hs-comment">-- only during testing and benchmarking, it must never contain anything on a real system.</span><span>
</span><span id="line-156"></span><span class="hs-comment">--</span><span>
</span><span id="line-157"></span><span class="hs-comment">-- /Warning/ - Should only be used in testing and benchmarking. Will result in an error</span><span>
</span><span id="line-158"></span><span class="hs-comment">-- when NetworkId is set to Mainnet</span><span>
</span><span id="line-159"></span><span id="local-6989586621679615956"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#tcInitialFundsL"><span class="hs-identifier hs-type">tcInitialFundsL</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-160"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#EraTransition"><span class="hs-identifier hs-type">EraTransition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615956"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-161"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615956"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LM.ListMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Addr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EraCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679615956"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Coin</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-162"></span><span id="tcInitialFundsL"><span class="annot"><span class="annottext">tcInitialFundsL :: forall era.
(HasCallStack, EraTransition era) =&gt;
Lens' (TransitionConfig era) (ListMap (Addr (EraCrypto era)) Coin)
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcInitialFundsL"><span class="hs-identifier hs-var hs-var">tcInitialFundsL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>  </span><span class="annot"><span class="annottext">(ShelleyGenesis (EraCrypto era)
 -&gt; f (ShelleyGenesis (EraCrypto era)))
-&gt; TransitionConfig era -&gt; f (TransitionConfig era)
forall era.
EraTransition era =&gt;
Lens' (TransitionConfig era) (ShelleyGenesis (EraCrypto era))
Lens' (TransitionConfig era) (ShelleyGenesis (EraCrypto era))
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcShelleyGenesisL"><span class="hs-identifier hs-var">tcShelleyGenesisL</span></a></span><span>
</span><span id="line-164"></span><span>    </span><span class="annot"><span class="annottext">((ShelleyGenesis (EraCrypto era)
  -&gt; f (ShelleyGenesis (EraCrypto era)))
 -&gt; TransitionConfig era -&gt; f (TransitionConfig era))
-&gt; ((ListMap (Addr (EraCrypto era)) Coin
     -&gt; f (ListMap (Addr (EraCrypto era)) Coin))
    -&gt; ShelleyGenesis (EraCrypto era)
    -&gt; f (ShelleyGenesis (EraCrypto era)))
-&gt; (ListMap (Addr (EraCrypto era)) Coin
    -&gt; f (ListMap (Addr (EraCrypto era)) Coin))
-&gt; TransitionConfig era
-&gt; f (TransitionConfig era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ShelleyGenesis (EraCrypto era)
 -&gt; ListMap (Addr (EraCrypto era)) Coin)
-&gt; (ShelleyGenesis (EraCrypto era)
    -&gt; ListMap (Addr (EraCrypto era)) Coin
    -&gt; ShelleyGenesis (EraCrypto era))
-&gt; Lens
     (ShelleyGenesis (EraCrypto era))
     (ShelleyGenesis (EraCrypto era))
     (ListMap (Addr (EraCrypto era)) Coin)
     (ListMap (Addr (EraCrypto era)) Coin)
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><span class="hs-identifier hs-var">lens</span></span><span>
</span><span id="line-165"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679616298"><span class="annot"><span class="annottext">ShelleyGenesis (EraCrypto era)
</span><a href="#local-6989586621679616298"><span class="hs-identifier hs-var">sg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; ShelleyGenesis (EraCrypto era)
-&gt; (ListMap (Addr (EraCrypto era)) Coin -&gt; Bool)
-&gt; ListMap (Addr (EraCrypto era)) Coin
-&gt; ListMap (Addr (EraCrypto era)) Coin
forall c a.
HasCallStack =&gt;
String -&gt; ShelleyGenesis c -&gt; (a -&gt; Bool) -&gt; a -&gt; a
</span><a href="Cardano.Ledger.Shelley.Transition.html#protectMainnet"><span class="hs-identifier hs-var">protectMainnet</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;InitialFunds&quot;</span></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis (EraCrypto era)
</span><a href="#local-6989586621679616298"><span class="hs-identifier hs-var">sg</span></a></span><span> </span><span class="annot"><span class="annottext">ListMap (Addr (EraCrypto era)) Coin -&gt; Bool
forall a. ListMap (Addr (EraCrypto era)) a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyGenesis (EraCrypto era)
-&gt; ListMap (Addr (EraCrypto era)) Coin
forall c. ShelleyGenesis c -&gt; ListMap (Addr c) Coin
</span><a href="Cardano.Ledger.Shelley.Genesis.html#sgInitialFunds"><span class="hs-identifier hs-var">sgInitialFunds</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis (EraCrypto era)
</span><a href="#local-6989586621679616298"><span class="hs-identifier hs-var">sg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679616302"><span class="annot"><span class="annottext">ShelleyGenesis (EraCrypto era)
</span><a href="#local-6989586621679616302"><span class="hs-identifier hs-var">sg</span></a></span></span><span> </span><span id="local-6989586621679616303"><span class="annot"><span class="annottext">ListMap (Addr (EraCrypto era)) Coin
</span><a href="#local-6989586621679616303"><span class="hs-identifier hs-var">initialFunds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis (EraCrypto era)
</span><a href="#local-6989586621679616302"><span class="hs-identifier hs-var">sg</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.Shelley.Genesis.html#sgInitialFunds"><span class="hs-identifier hs-var">sgInitialFunds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679616303"><span class="hs-identifier hs-type">initialFunds</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-comment">-- | Get the initial staking from the `TransitionConfig`. This value must be non-empty</span><span>
</span><span id="line-169"></span><span class="hs-comment">-- only during testing and benchmarking, it must never contain anything on a real system.</span><span>
</span><span id="line-170"></span><span class="hs-comment">--</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- /Warning/ - Should only be used in testing and benchmarking. Will result in an error</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- when NetworkId is set to Mainnet</span><span>
</span><span id="line-173"></span><span id="local-6989586621679615968"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#tcInitialStakingL"><span class="hs-identifier hs-type">tcInitialStakingL</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#EraTransition"><span class="hs-identifier hs-type">EraTransition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615968"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-175"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615968"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Genesis.html#ShelleyGenesisStaking"><span class="hs-identifier hs-type">ShelleyGenesisStaking</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EraCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679615968"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-176"></span><span id="tcInitialStakingL"><span class="annot"><span class="annottext">tcInitialStakingL :: forall era.
(HasCallStack, EraTransition era) =&gt;
Lens'
  (TransitionConfig era) (ShelleyGenesisStaking (EraCrypto era))
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcInitialStakingL"><span class="hs-identifier hs-var hs-var">tcInitialStakingL</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-177"></span><span>  </span><span class="annot"><span class="annottext">(ShelleyGenesis (EraCrypto era)
 -&gt; f (ShelleyGenesis (EraCrypto era)))
-&gt; TransitionConfig era -&gt; f (TransitionConfig era)
forall era.
EraTransition era =&gt;
Lens' (TransitionConfig era) (ShelleyGenesis (EraCrypto era))
Lens' (TransitionConfig era) (ShelleyGenesis (EraCrypto era))
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcShelleyGenesisL"><span class="hs-identifier hs-var">tcShelleyGenesisL</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><span class="annottext">((ShelleyGenesis (EraCrypto era)
  -&gt; f (ShelleyGenesis (EraCrypto era)))
 -&gt; TransitionConfig era -&gt; f (TransitionConfig era))
-&gt; ((ShelleyGenesisStaking (EraCrypto era)
     -&gt; f (ShelleyGenesisStaking (EraCrypto era)))
    -&gt; ShelleyGenesis (EraCrypto era)
    -&gt; f (ShelleyGenesis (EraCrypto era)))
-&gt; (ShelleyGenesisStaking (EraCrypto era)
    -&gt; f (ShelleyGenesisStaking (EraCrypto era)))
-&gt; TransitionConfig era
-&gt; f (TransitionConfig era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ShelleyGenesis (EraCrypto era)
 -&gt; ShelleyGenesisStaking (EraCrypto era))
-&gt; (ShelleyGenesis (EraCrypto era)
    -&gt; ShelleyGenesisStaking (EraCrypto era)
    -&gt; ShelleyGenesis (EraCrypto era))
-&gt; Lens
     (ShelleyGenesis (EraCrypto era))
     (ShelleyGenesis (EraCrypto era))
     (ShelleyGenesisStaking (EraCrypto era))
     (ShelleyGenesisStaking (EraCrypto era))
forall s a b t. (s -&gt; a) -&gt; (s -&gt; b -&gt; t) -&gt; Lens s t a b
</span><span class="hs-identifier hs-var">lens</span></span><span>
</span><span id="line-179"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679616316"><span class="annot"><span class="annottext">ShelleyGenesis (EraCrypto era)
</span><a href="#local-6989586621679616316"><span class="hs-identifier hs-var">sg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; ShelleyGenesis (EraCrypto era)
-&gt; (ShelleyGenesisStaking (EraCrypto era) -&gt; Bool)
-&gt; ShelleyGenesisStaking (EraCrypto era)
-&gt; ShelleyGenesisStaking (EraCrypto era)
forall c a.
HasCallStack =&gt;
String -&gt; ShelleyGenesis c -&gt; (a -&gt; Bool) -&gt; a -&gt; a
</span><a href="Cardano.Ledger.Shelley.Transition.html#protectMainnet"><span class="hs-identifier hs-var">protectMainnet</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;InitialStaking&quot;</span></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis (EraCrypto era)
</span><a href="#local-6989586621679616316"><span class="hs-identifier hs-var">sg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyGenesisStaking (EraCrypto era)
-&gt; ShelleyGenesisStaking (EraCrypto era) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesisStaking (EraCrypto era)
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyGenesis (EraCrypto era)
-&gt; ShelleyGenesisStaking (EraCrypto era)
forall c. ShelleyGenesis c -&gt; ShelleyGenesisStaking c
</span><a href="Cardano.Ledger.Shelley.Genesis.html#sgStaking"><span class="hs-identifier hs-var">sgStaking</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis (EraCrypto era)
</span><a href="#local-6989586621679616316"><span class="hs-identifier hs-var">sg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679616318"><span class="annot"><span class="annottext">ShelleyGenesis (EraCrypto era)
</span><a href="#local-6989586621679616318"><span class="hs-identifier hs-var">sg</span></a></span></span><span> </span><span id="local-6989586621679616319"><span class="annot"><span class="annottext">ShelleyGenesisStaking (EraCrypto era)
</span><a href="#local-6989586621679616319"><span class="hs-identifier hs-var">staking</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis (EraCrypto era)
</span><a href="#local-6989586621679616318"><span class="hs-identifier hs-var">sg</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><a href="Cardano.Ledger.Shelley.Genesis.html#sgStaking"><span class="hs-identifier hs-var">sgStaking</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679616319"><span class="hs-identifier hs-type">staking</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span id="local-6989586621679615963"><span id="local-6989586621679615964"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#protectMainnet"><span class="hs-identifier hs-type">protectMainnet</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Genesis.html#ShelleyGenesis"><span class="hs-identifier hs-type">ShelleyGenesis</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615963"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679615964"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#Bool"><span class="hs-identifier hs-type">Bool</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679615964"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679615964"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-183"></span><span id="protectMainnet"><span class="annot"><span class="annottext">protectMainnet :: forall c a.
HasCallStack =&gt;
String -&gt; ShelleyGenesis c -&gt; (a -&gt; Bool) -&gt; a -&gt; a
</span><a href="Cardano.Ledger.Shelley.Transition.html#protectMainnet"><span class="hs-identifier hs-var hs-var">protectMainnet</span></a></span></span><span> </span><span id="local-6989586621679616329"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679616329"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621679616330"><span class="annot"><span class="annottext">ShelleyGenesis c
</span><a href="#local-6989586621679616330"><span class="hs-identifier hs-var">sg</span></a></span></span><span> </span><span id="local-6989586621679616331"><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679616331"><span class="hs-identifier hs-var">isMainnetSafe</span></a></span></span><span> </span><span id="local-6989586621679616332"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679616332"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-184"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis c -&gt; Network
forall c. ShelleyGenesis c -&gt; Network
</span><a href="Cardano.Ledger.Shelley.Genesis.html#sgNetworkId"><span class="hs-identifier hs-var">sgNetworkId</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis c
</span><a href="#local-6989586621679616330"><span class="hs-identifier hs-var">sg</span></a></span><span> </span><span class="annot"><span class="annottext">Network -&gt; Network -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3D%3D"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Network
</span><span class="hs-identifier hs-var">Mainnet</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%26%26"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#not"><span class="hs-identifier hs-var">not</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Bool
</span><a href="#local-6989586621679616331"><span class="hs-identifier hs-var">isMainnetSafe</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679616332"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; a) -&gt; String -&gt; a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Injection of &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679616329"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; is not possible on Mainnet&quot;</span></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679616332"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span id="local-6989586621679615989"><span id="local-6989586621679616339"><span id="local-6989586621679616344"><span id="local-6989586621679616348"><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Crypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679615989"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">NoThunks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyEra"><span class="hs-identifier hs-type">ShelleyEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679615989"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679616353"><span id="local-6989586621679616358"><span id="local-6989586621679616361"><span class="annot"><span class="hs-identifier hs-type">Crypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679616353"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyEra"><span class="hs-identifier hs-type">ShelleyEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616353"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-191"></span><span>  </span><span id="local-6989586621679616369"><span class="annot"><span class="annottext">toJSON :: TransitionConfig (ShelleyEra c) -&gt; Value
</span><a href="#local-6989586621679616369"><span class="hs-identifier hs-var hs-var hs-var hs-var">toJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span> </span><span class="annot"><span class="annottext">([Pair] -&gt; Value)
-&gt; (TransitionConfig (ShelleyEra c) -&gt; [Pair])
-&gt; TransitionConfig (ShelleyEra c)
-&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TransitionConfig (ShelleyEra c) -&gt; [Pair]
forall a c.
(KeyValue a, Crypto c) =&gt;
TransitionConfig (ShelleyEra c) -&gt; [a]
</span><a href="Cardano.Ledger.Shelley.Transition.html#toShelleyTransitionConfigPairs"><span class="hs-identifier hs-var">toShelleyTransitionConfigPairs</span></a></span><span>
</span><span id="line-192"></span><span>  </span><span id="local-6989586621679616376"><span class="annot"><span class="annottext">toEncoding :: TransitionConfig (ShelleyEra c) -&gt; Encoding
</span><a href="#local-6989586621679616376"><span class="hs-identifier hs-var hs-var hs-var hs-var">toEncoding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Series -&gt; Encoding
</span><span class="hs-identifier hs-var">pairs</span></span><span> </span><span class="annot"><span class="annottext">(Series -&gt; Encoding)
-&gt; (TransitionConfig (ShelleyEra c) -&gt; Series)
-&gt; TransitionConfig (ShelleyEra c)
-&gt; Encoding
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Series] -&gt; Series
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mconcat"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="annot"><span class="annottext">([Series] -&gt; Series)
-&gt; (TransitionConfig (ShelleyEra c) -&gt; [Series])
-&gt; TransitionConfig (ShelleyEra c)
-&gt; Series
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TransitionConfig (ShelleyEra c) -&gt; [Series]
forall a c.
(KeyValue a, Crypto c) =&gt;
TransitionConfig (ShelleyEra c) -&gt; [a]
</span><a href="Cardano.Ledger.Shelley.Transition.html#toShelleyTransitionConfigPairs"><span class="hs-identifier hs-var">toShelleyTransitionConfigPairs</span></a></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679616378"><span id="local-6989586621679616382"><span class="annot"><span class="hs-identifier hs-type">Crypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679616378"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromJSON</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyEra"><span class="hs-identifier hs-type">ShelleyEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616378"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-195"></span><span>  </span><span id="local-6989586621679616393"><span class="annot"><span class="annottext">parseJSON :: Value -&gt; Parser (TransitionConfig (ShelleyEra c))
</span><a href="#local-6989586621679616393"><span class="hs-identifier hs-var hs-var hs-var hs-var">parseJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (Object -&gt; Parser (TransitionConfig (ShelleyEra c)))
-&gt; Value
-&gt; Parser (TransitionConfig (ShelleyEra c))
forall a. String -&gt; (Object -&gt; Parser a) -&gt; Value -&gt; Parser a
</span><span class="hs-identifier hs-var">withObject</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ShelleyTransitionConfig&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Object -&gt; Parser (TransitionConfig (ShelleyEra c)))
 -&gt; Value -&gt; Parser (TransitionConfig (ShelleyEra c)))
-&gt; (Object -&gt; Parser (TransitionConfig (ShelleyEra c)))
-&gt; Value
-&gt; Parser (TransitionConfig (ShelleyEra c))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679616395"><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679616395"><span class="hs-identifier hs-var">o</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-196"></span><span>    </span><span id="local-6989586621679616396"><span class="annot"><span class="annottext">ShelleyGenesis c
</span><a href="#local-6989586621679616396"><span class="hs-identifier hs-var">sg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Object
</span><a href="#local-6989586621679616395"><span class="hs-identifier hs-var">o</span></a></span><span> </span><span class="annot"><span class="annottext">Object -&gt; Key -&gt; Parser (ShelleyGenesis c)
forall a. FromJSON a =&gt; Object -&gt; Key -&gt; Parser a
</span><span class="hs-operator hs-var">.:</span></span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;shelley&quot;</span></span><span>
</span><span id="line-197"></span><span>    </span><span class="annot"><span class="annottext">TransitionConfig (ShelleyEra c)
-&gt; Parser (TransitionConfig (ShelleyEra c))
forall a. a -&gt; Parser a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(TransitionConfig (ShelleyEra c)
 -&gt; Parser (TransitionConfig (ShelleyEra c)))
-&gt; TransitionConfig (ShelleyEra c)
-&gt; Parser (TransitionConfig (ShelleyEra c))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#ShelleyTransitionConfig"><span class="hs-identifier hs-type">ShelleyTransitionConfig</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">stcShelleyGenesis :: ShelleyGenesis c
</span><a href="Cardano.Ledger.Shelley.Transition.html#stcShelleyGenesis"><span class="hs-identifier hs-var">stcShelleyGenesis</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis c
</span><a href="#local-6989586621679616396"><span class="hs-identifier hs-var">sg</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span id="local-6989586621679615999"><span id="local-6989586621679616000"><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#toShelleyTransitionConfigPairs"><span class="hs-identifier hs-type">toShelleyTransitionConfigPairs</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">KeyValue</span></span><span> </span><span class="annot"><a href="#local-6989586621679615999"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Crypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679616000"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyEra"><span class="hs-identifier hs-type">ShelleyEra</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616000"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679615999"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-203"></span><span id="toShelleyTransitionConfigPairs"><span class="annot"><span class="annottext">toShelleyTransitionConfigPairs :: forall a c.
(KeyValue a, Crypto c) =&gt;
TransitionConfig (ShelleyEra c) -&gt; [a]
</span><a href="Cardano.Ledger.Shelley.Transition.html#toShelleyTransitionConfigPairs"><span class="hs-identifier hs-var hs-var">toShelleyTransitionConfigPairs</span></a></span></span><span> </span><span id="local-6989586621679616407"><span class="annot"><span class="annottext">stc :: TransitionConfig (ShelleyEra c)
</span><a href="#local-6989586621679616407"><span class="hs-identifier hs-var">stc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#ShelleyTransitionConfig"><span class="hs-identifier hs-type">ShelleyTransitionConfig</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-204"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;shelley&quot;</span></span><span> </span><span class="annot"><span class="annottext">Key -&gt; Value -&gt; a
forall v. ToJSON v =&gt; Key -&gt; v -&gt; a
forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><span class="hs-identifier hs-var">object</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyGenesis c -&gt; [Pair]
forall a c. (KeyValue a, Crypto c) =&gt; ShelleyGenesis c -&gt; [a]
</span><a href="Cardano.Ledger.Shelley.Genesis.html#toShelleyGenesisPairs"><span class="hs-identifier hs-var">toShelleyGenesisPairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransitionConfig (ShelleyEra c) -&gt; ShelleyGenesis c
forall c. TransitionConfig (ShelleyEra c) -&gt; ShelleyGenesis c
</span><a href="Cardano.Ledger.Shelley.Transition.html#stcShelleyGenesis"><span class="hs-identifier hs-var">stcShelleyGenesis</span></a></span><span> </span><span class="annot"><span class="annottext">TransitionConfig (ShelleyEra c)
</span><a href="#local-6989586621679616407"><span class="hs-identifier hs-var">stc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="hs-comment">-- | Helper function for constructing the initial state for any era</span><span>
</span><span id="line-207"></span><span class="hs-comment">--</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- /Warning/ - Should only be used in testing and benchmarking. Will result in an error</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- when NetworkId is set to Mainnet</span><span>
</span><span id="line-210"></span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#createInitialState"><span class="hs-identifier hs-type">createInitialState</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679616017"><span class="annot"><a href="#local-6989586621679616017"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#EraTransition"><span class="hs-identifier hs-type">EraTransition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616017"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-213"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616017"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-214"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616017"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-215"></span><span id="createInitialState"><span class="annot"><span class="annottext">createInitialState :: forall era.
(EraTransition era, HasCallStack) =&gt;
TransitionConfig era -&gt; NewEpochState era
</span><a href="Cardano.Ledger.Shelley.Transition.html#createInitialState"><span class="hs-identifier hs-var hs-var">createInitialState</span></a></span></span><span> </span><span id="local-6989586621679616446"><span class="annot"><span class="annottext">TransitionConfig era
</span><a href="#local-6989586621679616446"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-216"></span><span>  </span><span class="annot"><span class="annottext">String
-&gt; ShelleyGenesis (EraCrypto era)
-&gt; (NewEpochState era -&gt; Bool)
-&gt; NewEpochState era
-&gt; NewEpochState era
forall c a.
HasCallStack =&gt;
String -&gt; ShelleyGenesis c -&gt; (a -&gt; Bool) -&gt; a -&gt; a
</span><a href="Cardano.Ledger.Shelley.Transition.html#protectMainnet"><span class="hs-identifier hs-var">protectMainnet</span></a></span><span>
</span><span id="line-217"></span><span>    </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;InitialState&quot;</span></span><span>
</span><span id="line-218"></span><span>    </span><span class="annot"><span class="annottext">ShelleyGenesis (EraCrypto era)
</span><a href="#local-6989586621679616447"><span class="hs-identifier hs-var">sg</span></a></span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; NewEpochState era -&gt; Bool
forall a b. a -&gt; b -&gt; a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Types.html#False"><span class="hs-identifier hs-var">False</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span>
</span><span id="line-221"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nesEL :: EpochNo
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#nesEL"><span class="hs-identifier hs-var">nesEL</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679616451"><span class="hs-identifier hs-var">initialEpochNo</span></a></span><span>
</span><span id="line-222"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nesBprev :: BlocksMade (EraCrypto era)
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#nesBprev"><span class="hs-identifier hs-var">nesBprev</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool (EraCrypto era)) Natural
-&gt; BlocksMade (EraCrypto era)
forall c. Map (KeyHash 'StakePool c) Natural -&gt; BlocksMade c
</span><span class="hs-identifier hs-var">BlocksMade</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool (EraCrypto era)) Natural
forall k a. Map k a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-223"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nesBcur :: BlocksMade (EraCrypto era)
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#nesBcur"><span class="hs-identifier hs-var">nesBcur</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool (EraCrypto era)) Natural
-&gt; BlocksMade (EraCrypto era)
forall c. Map (KeyHash 'StakePool c) Natural -&gt; BlocksMade c
</span><span class="hs-identifier hs-var">BlocksMade</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool (EraCrypto era)) Natural
forall k a. Map k a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-224"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nesEs :: EpochState era
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#nesEs"><span class="hs-identifier hs-var">nesEs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-225"></span><span>          </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#EpochState"><span class="hs-identifier hs-type">EpochState</span></a></span><span>
</span><span id="line-226"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">esAccountState :: AccountState
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#esAccountState"><span class="hs-identifier hs-var">esAccountState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; AccountState
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#AccountState"><span class="hs-identifier hs-var">AccountState</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
forall t. Val t =&gt; t
</span><span class="hs-identifier hs-var">zero</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679616461"><span class="hs-identifier hs-var">reserves</span></a></span><span>
</span><span id="line-227"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">esSnapshots :: SnapShots (EraCrypto era)
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#esSnapshots"><span class="hs-identifier hs-var">esSnapshots</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SnapShots (EraCrypto era)
forall c. SnapShots c
</span><span class="hs-identifier hs-var">emptySnapShots</span></span><span>
</span><span id="line-228"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">esLState :: LedgerState era
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#esLState"><span class="hs-identifier hs-var">esLState</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-229"></span><span>                </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#LedgerState"><span class="hs-identifier hs-type">LedgerState</span></a></span><span>
</span><span id="line-230"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lsUTxOState :: UTxOState era
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#lsUTxOState"><span class="hs-identifier hs-var">lsUTxOState</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-231"></span><span>                      </span><span class="annot"><span class="annottext">PParams era
-&gt; UTxO era
-&gt; Coin
-&gt; Coin
-&gt; GovState era
-&gt; Coin
-&gt; UTxOState era
forall era.
EraTxOut era =&gt;
PParams era
-&gt; UTxO era
-&gt; Coin
-&gt; Coin
-&gt; GovState era
-&gt; Coin
-&gt; UTxOState era
</span><a href="Cardano.Ledger.Shelley.LedgerState.IncrementalStake.html#smartUTxOState"><span class="hs-identifier hs-var">smartUTxOState</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679616468"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679616469"><span class="hs-identifier hs-var">initialUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
forall t. Val t =&gt; t
</span><span class="hs-identifier hs-var">zero</span></span><span> </span><span class="annot"><span class="annottext">Coin
forall t. Val t =&gt; t
</span><span class="hs-identifier hs-var">zero</span></span><span> </span><span class="annot"><span class="annottext">GovState era
</span><a href="#local-6989586621679616470"><span class="hs-identifier hs-var">govState</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
forall t. Val t =&gt; t
</span><span class="hs-identifier hs-var">zero</span></span><span>
</span><span id="line-232"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lsCertState :: CertState era
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#lsCertState"><span class="hs-identifier hs-var">lsCertState</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-233"></span><span>                      </span><span class="annot"><span class="hs-identifier hs-type">CertState</span></span><span>
</span><span id="line-234"></span><span>                        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">certDState :: DState era
</span><span class="hs-identifier hs-var">certDState</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DState era
</span><a href="#local-6989586621679616474"><span class="hs-identifier hs-var">dState</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="hs-identifier hs-var">dsGenDelegs</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GenDelegs</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Genesis.html#sgGenDelegs"><span class="hs-identifier hs-var">sgGenDelegs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616447"><span class="hs-identifier hs-type">sg</span></a></span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-235"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">certPState :: PState era
</span><span class="hs-identifier hs-var">certPState</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PState era
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-236"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">certVState :: VState era
</span><span class="hs-identifier hs-var">certVState</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VState era
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-237"></span><span>                        </span><span class="hs-special">}</span><span>
</span><span id="line-238"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-239"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">esNonMyopic :: NonMyopic (EraCrypto era)
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#esNonMyopic"><span class="hs-identifier hs-var">esNonMyopic</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonMyopic (EraCrypto era)
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-240"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-241"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nesRu :: StrictMaybe (PulsingRewUpdate (EraCrypto era))
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#nesRu"><span class="hs-identifier hs-var">nesRu</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StrictMaybe (PulsingRewUpdate (EraCrypto era))
forall a. StrictMaybe a
</span><span class="hs-identifier hs-var">SNothing</span></span><span>
</span><span id="line-242"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nesPd :: PoolDistr (EraCrypto era)
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#nesPd"><span class="hs-identifier hs-var">nesPd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map
  (KeyHash 'StakePool (EraCrypto era))
  (IndividualPoolStake (EraCrypto era))
-&gt; PoolDistr (EraCrypto era)
forall c.
Map (KeyHash 'StakePool c) (IndividualPoolStake c) -&gt; PoolDistr c
</span><span class="hs-identifier hs-var">PoolDistr</span></span><span> </span><span class="annot"><span class="annottext">Map
  (KeyHash 'StakePool (EraCrypto era))
  (IndividualPoolStake (EraCrypto era))
forall k a. Map k a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-243"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stashedAVVMAddresses :: StashedAVVMAddresses era
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#stashedAVVMAddresses"><span class="hs-identifier hs-var">stashedAVVMAddresses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StashedAVVMAddresses era
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-244"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-245"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><a href="#local-6989586621679616474"><span class="hs-identifier hs-type">dState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DState</span></span><span> </span><span class="annot"><a href="#local-6989586621679616017"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-247"></span><span>    </span><span id="local-6989586621679616474"><span class="annot"><span class="annottext">dState :: DState era
</span><a href="#local-6989586621679616474"><span class="hs-identifier hs-var hs-var">dState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DState era
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><a href="#local-6989586621679616470"><span class="hs-identifier hs-type">govState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Governance.html#GovState"><span class="hs-identifier hs-type">GovState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616017"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span id="local-6989586621679616470"><span class="annot"><span class="annottext">govState :: GovState era
</span><a href="#local-6989586621679616470"><span class="hs-identifier hs-var hs-var">govState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-250"></span><span>      </span><span class="annot"><span class="annottext">GovState era
forall era. EraGov era =&gt; GovState era
</span><a href="Cardano.Ledger.Shelley.Governance.html#emptyGovState"><span class="hs-identifier hs-var">emptyGovState</span></a></span><span>
</span><span id="line-251"></span><span>        </span><span class="annot"><span class="annottext">GovState era -&gt; (GovState era -&gt; GovState era) -&gt; GovState era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(PParams era -&gt; Identity (PParams era))
-&gt; GovState era -&gt; Identity (GovState era)
forall era. EraGov era =&gt; Lens' (GovState era) (PParams era)
Lens' (GovState era) (PParams era)
</span><a href="Cardano.Ledger.Shelley.Governance.html#curPParamsGovStateL"><span class="hs-identifier hs-var">curPParamsGovStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((PParams era -&gt; Identity (PParams era))
 -&gt; GovState era -&gt; Identity (GovState era))
-&gt; PParams era -&gt; GovState era -&gt; GovState era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679616468"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-252"></span><span>        </span><span class="annot"><span class="annottext">GovState era -&gt; (GovState era -&gt; GovState era) -&gt; GovState era
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Function.html#%26"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(PParams era -&gt; Identity (PParams era))
-&gt; GovState era -&gt; Identity (GovState era)
forall era. EraGov era =&gt; Lens' (GovState era) (PParams era)
Lens' (GovState era) (PParams era)
</span><a href="Cardano.Ledger.Shelley.Governance.html#prevPParamsGovStateL"><span class="hs-identifier hs-var">prevPParamsGovStateL</span></a></span><span> </span><span class="annot"><span class="annottext">((PParams era -&gt; Identity (PParams era))
 -&gt; GovState era -&gt; Identity (GovState era))
-&gt; PParams era -&gt; GovState era -&gt; GovState era
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679616468"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-253"></span><span>    </span><span class="annot"><a href="#local-6989586621679616468"><span class="hs-identifier hs-type">pp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PParams</span></span><span> </span><span class="annot"><a href="#local-6989586621679616017"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621679616468"><span class="annot"><span class="annottext">pp :: PParams era
</span><a href="#local-6989586621679616468"><span class="hs-identifier hs-var hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransitionConfig era
</span><a href="#local-6989586621679616446"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TransitionConfig era
-&gt; Getting (PParams era) (TransitionConfig era) (PParams era)
-&gt; PParams era
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting (PParams era) (TransitionConfig era) (PParams era)
forall era.
EraTransition era =&gt;
SimpleGetter (TransitionConfig era) (PParams era)
SimpleGetter (TransitionConfig era) (PParams era)
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcInitialPParamsG"><span class="hs-identifier hs-var">tcInitialPParamsG</span></a></span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><a href="#local-6989586621679616447"><span class="hs-identifier hs-type">sg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Genesis.html#ShelleyGenesis"><span class="hs-identifier hs-type">ShelleyGenesis</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EraCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679616017"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-256"></span><span>    </span><span id="local-6989586621679616447"><span class="annot"><span class="annottext">sg :: ShelleyGenesis (EraCrypto era)
</span><a href="#local-6989586621679616447"><span class="hs-identifier hs-var hs-var">sg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransitionConfig era
</span><a href="#local-6989586621679616446"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TransitionConfig era
-&gt; Getting
     (ShelleyGenesis (EraCrypto era))
     (TransitionConfig era)
     (ShelleyGenesis (EraCrypto era))
-&gt; ShelleyGenesis (EraCrypto era)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (ShelleyGenesis (EraCrypto era))
  (TransitionConfig era)
  (ShelleyGenesis (EraCrypto era))
forall era.
EraTransition era =&gt;
Lens' (TransitionConfig era) (ShelleyGenesis (EraCrypto era))
Lens' (TransitionConfig era) (ShelleyGenesis (EraCrypto era))
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcShelleyGenesisL"><span class="hs-identifier hs-var">tcShelleyGenesisL</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><a href="#local-6989586621679616451"><span class="hs-identifier hs-type">initialEpochNo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span>
</span><span id="line-258"></span><span>    </span><span id="local-6989586621679616451"><span class="annot"><span class="annottext">initialEpochNo :: EpochNo
</span><a href="#local-6989586621679616451"><span class="hs-identifier hs-var hs-var">initialEpochNo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><span class="hs-number">0</span></span><span>
</span><span id="line-259"></span><span>    </span><span class="annot"><a href="#local-6989586621679616469"><span class="hs-identifier hs-type">initialUtxo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="annot"><a href="#local-6989586621679616017"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-260"></span><span>    </span><span id="local-6989586621679616469"><span class="annot"><span class="annottext">initialUtxo :: UTxO era
</span><a href="#local-6989586621679616469"><span class="hs-identifier hs-var hs-var">initialUtxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis (EraCrypto era) -&gt; UTxO era
forall era.
EraTxOut era =&gt;
ShelleyGenesis (EraCrypto era) -&gt; UTxO era
</span><a href="Cardano.Ledger.Shelley.Genesis.html#genesisUTxO"><span class="hs-identifier hs-var">genesisUTxO</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis (EraCrypto era)
</span><a href="#local-6989586621679616447"><span class="hs-identifier hs-var">sg</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><a href="#local-6989586621679616461"><span class="hs-identifier hs-type">reserves</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Coin</span></span><span>
</span><span id="line-262"></span><span>    </span><span id="local-6989586621679616461"><span class="annot"><span class="annottext">reserves :: Coin
</span><a href="#local-6989586621679616461"><span class="hs-identifier hs-var hs-var">reserves</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Coin
</span><span class="hs-identifier hs-var">word64ToCoin</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ShelleyGenesis (EraCrypto era) -&gt; Word64
forall c. ShelleyGenesis c -&gt; Word64
</span><a href="Cardano.Ledger.Shelley.Genesis.html#sgMaxLovelaceSupply"><span class="hs-identifier hs-var">sgMaxLovelaceSupply</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyGenesis (EraCrypto era)
</span><a href="#local-6989586621679616447"><span class="hs-identifier hs-var">sg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; Coin
forall t. Val t =&gt; t -&gt; t -&gt; t
</span><span class="hs-operator hs-var">&lt;-&gt;</span></span><span> </span><span class="annot"><span class="annottext">UTxO era -&gt; Coin
forall era. EraTxOut era =&gt; UTxO era -&gt; Coin
</span><span class="hs-identifier hs-var">coinBalance</span></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679616469"><span class="hs-identifier hs-var">initialUtxo</span></a></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="hs-comment">-- | Register the initial staking information in the 'NewEpochState'.</span><span>
</span><span id="line-265"></span><span class="hs-comment">--</span><span>
</span><span id="line-266"></span><span class="hs-comment">-- HERE BE DRAGONS! This function is intended to help in testing.</span><span>
</span><span id="line-267"></span><span class="hs-comment">--</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- In production, the genesis should /not/ contain any initial staking.</span><span>
</span><span id="line-269"></span><span class="hs-comment">--</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- Any existing staking information is overridden, but the UTxO is left</span><span>
</span><span id="line-271"></span><span class="hs-comment">-- untouched.</span><span>
</span><span id="line-272"></span><span class="hs-comment">--</span><span>
</span><span id="line-273"></span><span class="hs-comment">-- /Warning/ - Should only be used in testing and benchmarking. Will result in an error</span><span>
</span><span id="line-274"></span><span class="hs-comment">-- when NetworkId is set to Mainnet</span><span>
</span><span id="line-275"></span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#registerInitialStaking"><span class="hs-identifier hs-type">registerInitialStaking</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679616069"><span class="annot"><a href="#local-6989586621679616069"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-277"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#EraTransition"><span class="hs-identifier hs-type">EraTransition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616069"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-280"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616069"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616069"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-282"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616069"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-283"></span><span id="registerInitialStaking"><span class="annot"><span class="annottext">registerInitialStaking :: forall era.
(EraTransition era, HasCallStack) =&gt;
TransitionConfig era -&gt; NewEpochState era -&gt; NewEpochState era
</span><a href="Cardano.Ledger.Shelley.Transition.html#registerInitialStaking"><span class="hs-identifier hs-var hs-var">registerInitialStaking</span></a></span></span><span> </span><span id="local-6989586621679616530"><span class="annot"><span class="annottext">TransitionConfig era
</span><a href="#local-6989586621679616530"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621679616531"><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679616531"><span class="hs-identifier hs-var">nes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679616531"><span class="hs-identifier hs-var">nes</span></a></span><span>
</span><span id="line-285"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#nesEs"><span class="hs-identifier hs-var">nesEs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-286"></span><span>        </span><span class="annot"><a href="#local-6989586621679616532"><span class="hs-identifier hs-type">epochState</span></a></span><span>
</span><span id="line-287"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#esLState"><span class="hs-identifier hs-var">esLState</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-288"></span><span>              </span><span class="annot"><a href="#local-6989586621679616533"><span class="hs-identifier hs-type">ledgerState</span></a></span><span>
</span><span id="line-289"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#lsCertState"><span class="hs-identifier hs-var">lsCertState</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-290"></span><span>                    </span><span class="annot"><a href="#local-6989586621679616534"><span class="hs-identifier hs-type">dpState</span></a></span><span>
</span><span id="line-291"></span><span>                      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">certDState</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679616535"><span class="hs-identifier hs-type">dState'</span></a></span><span>
</span><span id="line-292"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">certPState</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679616536"><span class="hs-identifier hs-type">pState'</span></a></span><span>
</span><span id="line-293"></span><span>                      </span><span class="hs-special">}</span><span>
</span><span id="line-294"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-295"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#esSnapshots"><span class="hs-identifier hs-var">esSnapshots</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-296"></span><span>              </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#esSnapshots"><span class="hs-identifier hs-var">esSnapshots</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616532"><span class="hs-identifier hs-type">epochState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">ssStakeMark</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679616538"><span class="hs-identifier hs-type">initSnapShot</span></a></span><span>
</span><span id="line-298"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-var">ssStakeMarkPoolDistr</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">calculatePoolDistr</span></span><span> </span><span class="annot"><a href="#local-6989586621679616538"><span class="hs-identifier hs-type">initSnapShot</span></a></span><span>
</span><span id="line-299"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-300"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Note that this is only applicable in the initial configuration where</span><span>
</span><span id="line-302"></span><span>      </span><span class="hs-comment">-- there is no existing stake distribution, since it would completely</span><span>
</span><span id="line-303"></span><span>      </span><span class="hs-comment">-- overwrite any such thing.</span><span>
</span><span id="line-304"></span><span>      </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#nesPd"><span class="hs-identifier hs-var">nesPd</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">calculatePoolDistr</span></span><span> </span><span class="annot"><a href="#local-6989586621679616538"><span class="hs-identifier hs-type">initSnapShot</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-307"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Shelley.Genesis.html#ShelleyGenesisStaking"><span class="hs-identifier hs-type">ShelleyGenesisStaking</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679616542"><span class="annot"><span class="annottext">ListMap
  (KeyHash 'StakePool (EraCrypto era)) (PoolParams (EraCrypto era))
sgsPools :: ListMap
  (KeyHash 'StakePool (EraCrypto era)) (PoolParams (EraCrypto era))
sgsPools :: forall c.
ShelleyGenesisStaking c
-&gt; ListMap (KeyHash 'StakePool c) (PoolParams c)
</span><a href="#local-6989586621679616542"><span class="hs-identifier hs-var hs-var">sgsPools</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679616544"><span class="annot"><span class="annottext">ListMap
  (KeyHash 'Staking (EraCrypto era))
  (KeyHash 'StakePool (EraCrypto era))
sgsStake :: ListMap
  (KeyHash 'Staking (EraCrypto era))
  (KeyHash 'StakePool (EraCrypto era))
sgsStake :: forall c.
ShelleyGenesisStaking c
-&gt; ListMap (KeyHash 'Staking c) (KeyHash 'StakePool c)
</span><a href="#local-6989586621679616544"><span class="hs-identifier hs-var hs-var">sgsStake</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TransitionConfig era
</span><a href="#local-6989586621679616530"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TransitionConfig era
-&gt; Getting
     (ShelleyGenesisStaking (EraCrypto era))
     (TransitionConfig era)
     (ShelleyGenesisStaking (EraCrypto era))
-&gt; ShelleyGenesisStaking (EraCrypto era)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (ShelleyGenesisStaking (EraCrypto era))
  (TransitionConfig era)
  (ShelleyGenesisStaking (EraCrypto era))
forall era.
(HasCallStack, EraTransition era) =&gt;
Lens'
  (TransitionConfig era) (ShelleyGenesisStaking (EraCrypto era))
Lens'
  (TransitionConfig era) (ShelleyGenesisStaking (EraCrypto era))
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcInitialStakingL"><span class="hs-identifier hs-var">tcInitialStakingL</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">nesEs :: forall era. NewEpochState era -&gt; EpochState era
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#nesEs"><span class="hs-identifier hs-var">nesEs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679616532"><span class="annot"><span class="annottext">EpochState era
</span><a href="#local-6989586621679616532"><span class="hs-identifier hs-var">epochState</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679616531"><span class="hs-identifier hs-var">nes</span></a></span><span>
</span><span id="line-309"></span><span>    </span><span id="local-6989586621679616533"><span class="annot"><span class="annottext">ledgerState :: LedgerState era
</span><a href="#local-6989586621679616533"><span class="hs-identifier hs-var hs-var">ledgerState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochState era -&gt; LedgerState era
forall era. EpochState era -&gt; LedgerState era
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#esLState"><span class="hs-identifier hs-var">esLState</span></a></span><span> </span><span class="annot"><span class="annottext">EpochState era
</span><a href="#local-6989586621679616532"><span class="hs-identifier hs-var">epochState</span></a></span><span>
</span><span id="line-310"></span><span>    </span><span id="local-6989586621679616534"><span class="annot"><span class="annottext">dpState :: CertState era
</span><a href="#local-6989586621679616534"><span class="hs-identifier hs-var hs-var">dpState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerState era -&gt; CertState era
forall era. LedgerState era -&gt; CertState era
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#lsCertState"><span class="hs-identifier hs-var">lsCertState</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState era
</span><a href="#local-6989586621679616533"><span class="hs-identifier hs-var">ledgerState</span></a></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-comment">-- New delegation state. Since we're using base addresses, we only care</span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-comment">-- about updating the '_delegations' field.</span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-comment">-- See STS DELEG for details</span><span>
</span><span id="line-316"></span><span>    </span><span class="annot"><a href="#local-6989586621679616535"><span class="hs-identifier hs-type">dState'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DState</span></span><span> </span><span class="annot"><a href="#local-6989586621679616069"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-317"></span><span>    </span><span id="local-6989586621679616535"><span class="annot"><span class="annottext">dState' :: DState era
</span><a href="#local-6989586621679616535"><span class="hs-identifier hs-var hs-var">dState'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-318"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CertState era -&gt; DState era
forall era. CertState era -&gt; DState era
</span><span class="hs-identifier hs-var">certDState</span></span><span> </span><span class="annot"><span class="annottext">CertState era
</span><a href="#local-6989586621679616534"><span class="hs-identifier hs-var">dpState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">dsUnified</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-320"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">UM.unify</span></span><span>
</span><span id="line-321"></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.Internal.html#map"><span class="hs-identifier hs-type">Map.map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#const"><span class="hs-identifier hs-type">const</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-type">$</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UM.RDPair</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">CompactCoin</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">CompactCoin</span></span><span> </span><span class="annot"><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>                  </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-type">.</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#mapKeys"><span class="hs-identifier hs-type">Map.mapKeys</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">KeyHashObj</span></span><span>
</span><span id="line-323"></span><span>                  </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-type">$</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616553"><span class="hs-identifier hs-type">sgsStakeMap</span></a></span><span>
</span><span id="line-324"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>              </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-type">mempty</span></a></span><span>
</span><span id="line-326"></span><span>              </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#mapKeys"><span class="hs-identifier hs-type">Map.mapKeys</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">KeyHashObj</span></span><span> </span><span class="annot"><a href="#local-6989586621679616553"><span class="hs-identifier hs-type">sgsStakeMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>              </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-type">mempty</span></a></span><span>
</span><span id="line-328"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-329"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-330"></span><span>        </span><span id="local-6989586621679616553"><span class="annot"><span class="annottext">sgsStakeMap :: Map
  (KeyHash 'Staking (EraCrypto era))
  (KeyHash 'StakePool (EraCrypto era))
</span><a href="#local-6989586621679616553"><span class="hs-identifier hs-var hs-var">sgsStakeMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ListMap
  (KeyHash 'Staking (EraCrypto era))
  (KeyHash 'StakePool (EraCrypto era))
-&gt; Map
     (KeyHash 'Staking (EraCrypto era))
     (KeyHash 'StakePool (EraCrypto era))
forall k v. Ord k =&gt; ListMap k v -&gt; Map k v
</span><span class="hs-identifier hs-var">ListMap.toMap</span></span><span> </span><span class="annot"><span class="annottext">ListMap
  (KeyHash 'Staking (EraCrypto era))
  (KeyHash 'StakePool (EraCrypto era))
</span><a href="#local-6989586621679616544"><span class="hs-identifier hs-var">sgsStake</span></a></span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span>    </span><span class="hs-comment">-- We consider pools as having been registered in slot 0</span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-comment">-- See STS POOL for details</span><span>
</span><span id="line-334"></span><span>    </span><span class="annot"><a href="#local-6989586621679616536"><span class="hs-identifier hs-type">pState'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PState</span></span><span> </span><span class="annot"><a href="#local-6989586621679616069"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-335"></span><span>    </span><span id="local-6989586621679616536"><span class="annot"><span class="annottext">pState' :: PState era
</span><a href="#local-6989586621679616536"><span class="hs-identifier hs-var hs-var">pState'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-336"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CertState era -&gt; PState era
forall era. CertState era -&gt; PState era
</span><span class="hs-identifier hs-var">certPState</span></span><span> </span><span class="annot"><span class="annottext">CertState era
</span><a href="#local-6989586621679616534"><span class="hs-identifier hs-var">dpState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-identifier hs-var">psStakePoolParams</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ListMap.toMap</span></span><span> </span><span class="annot"><a href="#local-6989586621679616542"><span class="hs-identifier hs-type">sgsPools</span></a></span><span>
</span><span id="line-338"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span>    </span><span id="local-6989586621679616556"><span class="annot"><span class="annottext">pp :: PParams era
</span><a href="#local-6989586621679616556"><span class="hs-identifier hs-var hs-var">pp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679616531"><span class="hs-identifier hs-var">nes</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState era
-&gt; Getting (PParams era) (NewEpochState era) (PParams era)
-&gt; PParams era
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">(EpochState era -&gt; Const (PParams era) (EpochState era))
-&gt; NewEpochState era -&gt; Const (PParams era) (NewEpochState era)
forall era (f :: * -&gt; *).
Functor f =&gt;
(EpochState era -&gt; f (EpochState era))
-&gt; NewEpochState era -&gt; f (NewEpochState era)
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-var">nesEsL</span></a></span><span> </span><span class="annot"><span class="annottext">((EpochState era -&gt; Const (PParams era) (EpochState era))
 -&gt; NewEpochState era -&gt; Const (PParams era) (NewEpochState era))
-&gt; ((PParams era -&gt; Const (PParams era) (PParams era))
    -&gt; EpochState era -&gt; Const (PParams era) (EpochState era))
-&gt; Getting (PParams era) (NewEpochState era) (PParams era)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(PParams era -&gt; Const (PParams era) (PParams era))
-&gt; EpochState era -&gt; Const (PParams era) (EpochState era)
forall era. EraGov era =&gt; Lens' (EpochState era) (PParams era)
Lens' (EpochState era) (PParams era)
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#curPParamsEpochStateL"><span class="hs-identifier hs-var">curPParamsEpochStateL</span></a></span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-comment">-- The new stake distribution is made on the basis of a snapshot taken</span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-comment">-- during the previous epoch. We create a &quot;fake&quot; snapshot in order to</span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-comment">-- establish an initial stake distribution.</span><span>
</span><span id="line-345"></span><span>    </span><span class="annot"><a href="#local-6989586621679616538"><span class="hs-identifier hs-type">initSnapShot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SnapShot</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EraCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679616069"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>    </span><span id="local-6989586621679616538"><span class="annot"><span class="annottext">initSnapShot :: SnapShot (EraCrypto era)
</span><a href="#local-6989586621679616538"><span class="hs-identifier hs-var hs-var">initSnapShot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-347"></span><span>      </span><span class="hs-comment">-- Since we build a stake from nothing, we first initialise an</span><span>
</span><span id="line-348"></span><span>      </span><span class="hs-comment">-- 'IncrementalStake' as empty, and then:</span><span>
</span><span id="line-349"></span><span>      </span><span class="hs-comment">--</span><span>
</span><span id="line-350"></span><span>      </span><span class="hs-comment">-- 1. Add the initial UTxO, whilst deleting nothing.</span><span>
</span><span id="line-351"></span><span>      </span><span class="hs-comment">-- 2. Update the stake map given the initial delegation.</span><span>
</span><span id="line-352"></span><span>      </span><span class="annot"><span class="annottext">PParams era
-&gt; IncrementalStake (EraCrypto era)
-&gt; DState era
-&gt; PState era
-&gt; SnapShot (EraCrypto era)
forall era.
EraPParams era =&gt;
PParams era
-&gt; IncrementalStake (EraCrypto era)
-&gt; DState era
-&gt; PState era
-&gt; SnapShot (EraCrypto era)
</span><a href="Cardano.Ledger.Shelley.LedgerState.IncrementalStake.html#incrementalStakeDistr"><span class="hs-identifier hs-var">incrementalStakeDistr</span></a></span><span>
</span><span id="line-353"></span><span>        </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679616556"><span class="hs-identifier hs-var">pp</span></a></span><span>
</span><span id="line-354"></span><span>        </span><span class="hs-comment">-- Note that 'updateStakeDistribution' takes first the set of UTxO to</span><span>
</span><span id="line-355"></span><span>        </span><span class="hs-comment">-- delete, and then the set to add. In our case, there is nothing to</span><span>
</span><span id="line-356"></span><span>        </span><span class="hs-comment">-- delete, since this is an initial UTxO set.</span><span>
</span><span id="line-357"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PParams era
-&gt; IncrementalStake (EraCrypto era)
-&gt; UTxO era
-&gt; UTxO era
-&gt; IncrementalStake (EraCrypto era)
forall era.
EraTxOut era =&gt;
PParams era
-&gt; IncrementalStake (EraCrypto era)
-&gt; UTxO era
-&gt; UTxO era
-&gt; IncrementalStake (EraCrypto era)
</span><a href="Cardano.Ledger.Shelley.LedgerState.IncrementalStake.html#updateStakeDistribution"><span class="hs-identifier hs-var">updateStakeDistribution</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679616556"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">IncrementalStake (EraCrypto era)
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTxOState era -&gt; UTxO era
forall era. UTxOState era -&gt; UTxO era
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#utxosUtxo"><span class="hs-identifier hs-var">utxosUtxo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LedgerState era -&gt; UTxOState era
forall era. LedgerState era -&gt; UTxOState era
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#lsUTxOState"><span class="hs-identifier hs-var">lsUTxOState</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState era
</span><a href="#local-6989586621679616533"><span class="hs-identifier hs-var">ledgerState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>        </span><span class="annot"><span class="annottext">DState era
</span><a href="#local-6989586621679616535"><span class="hs-identifier hs-var">dState'</span></a></span><span>
</span><span id="line-359"></span><span>        </span><span class="annot"><span class="annottext">PState era
</span><a href="#local-6989586621679616536"><span class="hs-identifier hs-var">pState'</span></a></span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span class="hs-comment">-- | Register the initial funds in the 'NewEpochState'.</span><span>
</span><span id="line-362"></span><span class="hs-comment">--</span><span>
</span><span id="line-363"></span><span class="hs-comment">-- HERE BE DRAGONS! This function is intended to help in testing.</span><span>
</span><span id="line-364"></span><span class="hs-comment">--</span><span>
</span><span id="line-365"></span><span class="hs-comment">-- In production, the genesis should /not/ contain any initial funds.</span><span>
</span><span id="line-366"></span><span class="hs-comment">--</span><span>
</span><span id="line-367"></span><span class="hs-comment">-- The given funds are /added/ to the existing UTxO.</span><span>
</span><span id="line-368"></span><span class="hs-comment">--</span><span>
</span><span id="line-369"></span><span class="hs-comment">-- PRECONDITION: the given funds must not be part of the existing UTxO.</span><span>
</span><span id="line-370"></span><span class="hs-comment">-- &gt; forall (addr, _) in initialFunds.</span><span>
</span><span id="line-371"></span><span class="hs-comment">-- &gt;    Map.notElem (initialFundsPseudoTxIn addr) existingUTxO</span><span>
</span><span id="line-372"></span><span class="hs-comment">--</span><span>
</span><span id="line-373"></span><span class="hs-comment">-- PROPERTY:</span><span>
</span><span id="line-374"></span><span class="hs-comment">-- &gt;    genesisUTxO genesis</span><span>
</span><span id="line-375"></span><span class="hs-comment">-- &gt; == &lt;genesisUTxO'&gt; (sgInitialFunds genesis)</span><span>
</span><span id="line-376"></span><span class="hs-comment">-- &gt; == &lt;extractUTxO&gt; (registerInitialFunds (sgInitialFunds genesis)</span><span>
</span><span id="line-377"></span><span class="hs-comment">-- &gt;                                        &lt;empty NewEpochState&gt;)</span><span>
</span><span id="line-378"></span><span class="hs-comment">--</span><span>
</span><span id="line-379"></span><span class="hs-comment">-- /Warning/ - Should only be used in testing and benchmarking. Will result in an error</span><span>
</span><span id="line-380"></span><span class="hs-comment">-- when NetworkId is set to Mainnet</span><span>
</span><span id="line-381"></span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#registerInitialFunds"><span class="hs-identifier hs-type">registerInitialFunds</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679616562"><span class="annot"><a href="#local-6989586621679616562"><span class="hs-identifier hs-type">era</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#EraTransition"><span class="hs-identifier hs-type">EraTransition</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616562"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span>
</span><span id="line-385"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-386"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Transition.html#TransitionConfig"><span class="hs-identifier hs-type">TransitionConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616562"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-387"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616562"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-388"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#NewEpochState"><span class="hs-identifier hs-type">NewEpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679616562"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-389"></span><span id="registerInitialFunds"><span class="annot"><span class="annottext">registerInitialFunds :: forall era.
(EraTransition era, HasCallStack) =&gt;
TransitionConfig era -&gt; NewEpochState era -&gt; NewEpochState era
</span><a href="Cardano.Ledger.Shelley.Transition.html#registerInitialFunds"><span class="hs-identifier hs-var hs-var">registerInitialFunds</span></a></span></span><span> </span><span id="local-6989586621679616592"><span class="annot"><span class="annottext">TransitionConfig era
</span><a href="#local-6989586621679616592"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621679616593"><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679616593"><span class="hs-identifier hs-var">nes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-390"></span><span>  </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679616593"><span class="hs-identifier hs-var">nes</span></a></span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#nesEs"><span class="hs-identifier hs-var">nesEs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-392"></span><span>        </span><span class="annot"><a href="#local-6989586621679616594"><span class="hs-identifier hs-type">epochState</span></a></span><span>
</span><span id="line-393"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#esAccountState"><span class="hs-identifier hs-var">esAccountState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679616595"><span class="hs-identifier hs-type">accountState'</span></a></span><span>
</span><span id="line-394"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#esLState"><span class="hs-identifier hs-var">esLState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679616596"><span class="hs-identifier hs-type">ledgerState'</span></a></span><span>
</span><span id="line-395"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-397"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-398"></span><span>    </span><span id="local-6989586621679616594"><span class="annot"><span class="annottext">epochState :: EpochState era
</span><a href="#local-6989586621679616594"><span class="hs-identifier hs-var hs-var">epochState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NewEpochState era -&gt; EpochState era
forall era. NewEpochState era -&gt; EpochState era
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#nesEs"><span class="hs-identifier hs-var">nesEs</span></a></span><span> </span><span class="annot"><span class="annottext">NewEpochState era
</span><a href="#local-6989586621679616593"><span class="hs-identifier hs-var">nes</span></a></span><span>
</span><span id="line-399"></span><span>    </span><span id="local-6989586621679616597"><span class="annot"><span class="annottext">accountState :: AccountState
</span><a href="#local-6989586621679616597"><span class="hs-identifier hs-var hs-var">accountState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochState era -&gt; AccountState
forall era. EpochState era -&gt; AccountState
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#esAccountState"><span class="hs-identifier hs-var">esAccountState</span></a></span><span> </span><span class="annot"><span class="annottext">EpochState era
</span><a href="#local-6989586621679616594"><span class="hs-identifier hs-var">epochState</span></a></span><span>
</span><span id="line-400"></span><span>    </span><span id="local-6989586621679616598"><span class="annot"><span class="annottext">ledgerState :: LedgerState era
</span><a href="#local-6989586621679616598"><span class="hs-identifier hs-var hs-var">ledgerState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochState era -&gt; LedgerState era
forall era. EpochState era -&gt; LedgerState era
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#esLState"><span class="hs-identifier hs-var">esLState</span></a></span><span> </span><span class="annot"><span class="annottext">EpochState era
</span><a href="#local-6989586621679616594"><span class="hs-identifier hs-var">epochState</span></a></span><span>
</span><span id="line-401"></span><span>    </span><span id="local-6989586621679616599"><span class="annot"><span class="annottext">utxoState :: UTxOState era
</span><a href="#local-6989586621679616599"><span class="hs-identifier hs-var hs-var">utxoState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerState era -&gt; UTxOState era
forall era. LedgerState era -&gt; UTxOState era
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#lsUTxOState"><span class="hs-identifier hs-var">lsUTxOState</span></a></span><span> </span><span class="annot"><span class="annottext">LedgerState era
</span><a href="#local-6989586621679616598"><span class="hs-identifier hs-var">ledgerState</span></a></span><span>
</span><span id="line-402"></span><span>    </span><span id="local-6989586621679616600"><span class="annot"><span class="annottext">utxo :: UTxO era
</span><a href="#local-6989586621679616600"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOState era -&gt; UTxO era
forall era. UTxOState era -&gt; UTxO era
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#utxosUtxo"><span class="hs-identifier hs-var">utxosUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">UTxOState era
</span><a href="#local-6989586621679616599"><span class="hs-identifier hs-var">utxoState</span></a></span><span>
</span><span id="line-403"></span><span>    </span><span id="local-6989586621679616601"><span class="annot"><span class="annottext">reserves :: Coin
</span><a href="#local-6989586621679616601"><span class="hs-identifier hs-var hs-var">reserves</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AccountState -&gt; Coin
</span><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#asReserves"><span class="hs-identifier hs-var">asReserves</span></a></span><span> </span><span class="annot"><span class="annottext">AccountState
</span><a href="#local-6989586621679616597"><span class="hs-identifier hs-var">accountState</span></a></span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span>    </span><span class="annot"><a href="#local-6989586621679616603"><span class="hs-identifier hs-type">initialFundsUtxo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="annot"><a href="#local-6989586621679616562"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-406"></span><span>    </span><span id="local-6989586621679616603"><span class="annot"><span class="annottext">initialFundsUtxo :: UTxO era
</span><a href="#local-6989586621679616603"><span class="hs-identifier hs-var hs-var">initialFundsUtxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-407"></span><span>      </span><span class="annot"><span class="annottext">Map (TxIn (EraCrypto era)) (TxOut era) -&gt; UTxO era
forall era. Map (TxIn (EraCrypto era)) (TxOut era) -&gt; UTxO era
</span><span class="hs-identifier hs-var">UTxO</span></span><span> </span><span class="annot"><span class="annottext">(Map (TxIn (EraCrypto era)) (TxOut era) -&gt; UTxO era)
-&gt; Map (TxIn (EraCrypto era)) (TxOut era) -&gt; UTxO era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-408"></span><span>        </span><span class="annot"><span class="annottext">[(TxIn (EraCrypto era), TxOut era)]
-&gt; Map (TxIn (EraCrypto era)) (TxOut era)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span>
</span><span id="line-409"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn (EraCrypto era)
</span><a href="#local-6989586621679616606"><span class="hs-identifier hs-var">txIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><a href="#local-6989586621679616607"><span class="hs-identifier hs-var">txOut</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679616608"><span class="annot"><span class="annottext">Addr (EraCrypto era)
</span><a href="#local-6989586621679616608"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679616609"><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679616609"><span class="hs-identifier hs-var">amount</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ListMap (Addr (EraCrypto era)) Coin
-&gt; [(Addr (EraCrypto era), Coin)]
forall k v. ListMap k v -&gt; [(k, v)]
</span><span class="hs-identifier hs-var">ListMap.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TransitionConfig era
</span><a href="#local-6989586621679616592"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TransitionConfig era
-&gt; Getting
     (ListMap (Addr (EraCrypto era)) Coin)
     (TransitionConfig era)
     (ListMap (Addr (EraCrypto era)) Coin)
-&gt; ListMap (Addr (EraCrypto era)) Coin
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (ListMap (Addr (EraCrypto era)) Coin)
  (TransitionConfig era)
  (ListMap (Addr (EraCrypto era)) Coin)
forall era.
(HasCallStack, EraTransition era) =&gt;
Lens' (TransitionConfig era) (ListMap (Addr (EraCrypto era)) Coin)
Lens' (TransitionConfig era) (ListMap (Addr (EraCrypto era)) Coin)
</span><a href="Cardano.Ledger.Shelley.Transition.html#tcInitialFundsL"><span class="hs-identifier hs-var">tcInitialFundsL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-411"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679616606"><span class="annot"><span class="annottext">txIn :: TxIn (EraCrypto era)
</span><a href="#local-6989586621679616606"><span class="hs-identifier hs-var hs-var">txIn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Addr (EraCrypto era) -&gt; TxIn (EraCrypto era)
forall c. Crypto c =&gt; Addr c -&gt; TxIn c
</span><a href="Cardano.Ledger.Shelley.Genesis.html#initialFundsPseudoTxIn"><span class="hs-identifier hs-var">initialFundsPseudoTxIn</span></a></span><span> </span><span class="annot"><span class="annottext">Addr (EraCrypto era)
</span><a href="#local-6989586621679616608"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-412"></span><span>                </span><span id="local-6989586621679616607"><span class="annot"><span class="annottext">txOut :: TxOut era
</span><a href="#local-6989586621679616607"><span class="hs-identifier hs-var hs-var">txOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Addr (EraCrypto era) -&gt; Value era -&gt; TxOut era
forall era.
EraTxOut era =&gt;
Addr (EraCrypto era) -&gt; Value era -&gt; TxOut era
</span><span class="hs-identifier hs-var">mkBasicTxOut</span></span><span> </span><span class="annot"><span class="annottext">Addr (EraCrypto era)
</span><a href="#local-6989586621679616608"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coin -&gt; Value era
forall t. Val t =&gt; Coin -&gt; t
</span><span class="hs-identifier hs-var">inject</span></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679616609"><span class="hs-identifier hs-var">amount</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-413"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span>    </span><span id="local-6989586621679616614"><span class="annot"><span class="annottext">utxo' :: UTxO era
</span><a href="#local-6989586621679616614"><span class="hs-identifier hs-var hs-var">utxo'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; UTxO era -&gt; UTxO era -&gt; UTxO era
UTxO era -&gt; UTxO era -&gt; UTxO era
</span><a href="#local-6989586621679616615"><span class="hs-identifier hs-var">mergeUtxoNoOverlap</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679616600"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679616603"><span class="hs-identifier hs-var">initialFundsUtxo</span></a></span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-comment">-- Update the reserves</span><span>
</span><span id="line-418"></span><span>    </span><span id="local-6989586621679616595"><span class="annot"><span class="annottext">accountState' :: AccountState
</span><a href="#local-6989586621679616595"><span class="hs-identifier hs-var hs-var">accountState'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-419"></span><span>      </span><span class="annot"><span class="annottext">AccountState
</span><a href="#local-6989586621679616597"><span class="hs-identifier hs-var">accountState</span></a></span><span>
</span><span id="line-420"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#asReserves"><span class="hs-identifier hs-var">asReserves</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679616601"><span class="hs-identifier hs-type">reserves</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">&lt;-&gt;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">coin</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">balance</span></span><span> </span><span class="annot"><a href="#local-6989586621679616603"><span class="hs-identifier hs-type">initialFundsUtxo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span>    </span><span class="hs-comment">-- Since we only add entries to our UTxO, rather than spending them, there</span><span>
</span><span id="line-424"></span><span>    </span><span class="hs-comment">-- is nothing to delete in the incremental update.</span><span>
</span><span id="line-425"></span><span>    </span><span id="local-6989586621679616620"><span class="annot"><span class="annottext">utxoToDel :: UTxO era
</span><a href="#local-6989586621679616620"><span class="hs-identifier hs-var hs-var">utxoToDel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map (TxIn (EraCrypto era)) (TxOut era) -&gt; UTxO era
forall era. Map (TxIn (EraCrypto era)) (TxOut era) -&gt; UTxO era
</span><span class="hs-identifier hs-var">UTxO</span></span><span> </span><span class="annot"><span class="annottext">Map (TxIn (EraCrypto era)) (TxOut era)
forall a. Monoid a =&gt; a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-426"></span><span>    </span><span id="local-6989586621679616596"><span class="annot"><span class="annottext">ledgerState' :: LedgerState era
</span><a href="#local-6989586621679616596"><span class="hs-identifier hs-var hs-var">ledgerState'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-427"></span><span>      </span><span class="annot"><span class="annottext">LedgerState era
</span><a href="#local-6989586621679616598"><span class="hs-identifier hs-var">ledgerState</span></a></span><span>
</span><span id="line-428"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#lsUTxOState"><span class="hs-identifier hs-var">lsUTxOState</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-429"></span><span>            </span><span class="annot"><a href="#local-6989586621679616599"><span class="hs-identifier hs-type">utxoState</span></a></span><span>
</span><span id="line-430"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#utxosUtxo"><span class="hs-identifier hs-var">utxosUtxo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679616614"><span class="hs-identifier hs-type">utxo'</span></a></span><span>
</span><span id="line-431"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- Normally we would incrementally update here. But since we pass</span><span>
</span><span id="line-432"></span><span>                </span><span class="hs-comment">-- the full UTxO as &quot;toAdd&quot; rather than a delta, we simply</span><span>
</span><span id="line-433"></span><span>                </span><span class="hs-comment">-- reinitialise the full incremental stake.</span><span>
</span><span id="line-434"></span><span>                </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#utxosStakeDistr"><span class="hs-identifier hs-var">utxosStakeDistr</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-435"></span><span>                  </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.IncrementalStake.html#updateStakeDistribution"><span class="hs-identifier hs-type">updateStakeDistribution</span></a></span><span>
</span><span id="line-436"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679616593"><span class="hs-identifier hs-type">nes</span></a></span><span> </span><span class="annot"><span class="hs-operator hs-type">^.</span></span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#nesEsL"><span class="hs-identifier hs-type">nesEsL</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-type">.</span></a></span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#curPParamsEpochStateL"><span class="hs-identifier hs-type">curPParamsEpochStateL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span>                    </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#mempty"><span class="hs-identifier hs-type">mempty</span></a></span><span>
</span><span id="line-438"></span><span>                    </span><span class="annot"><a href="#local-6989586621679616620"><span class="hs-identifier hs-type">utxoToDel</span></a></span><span>
</span><span id="line-439"></span><span>                    </span><span class="annot"><a href="#local-6989586621679616614"><span class="hs-identifier hs-type">utxo'</span></a></span><span>
</span><span id="line-440"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-441"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-442"></span><span>
</span><span id="line-443"></span><span>    </span><span class="hs-comment">-- Merge two UTxOs, throw an 'error' in case of overlap</span><span>
</span><span id="line-444"></span><span>    </span><span class="annot"><a href="#local-6989586621679616615"><span class="hs-identifier hs-type">mergeUtxoNoOverlap</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-445"></span><span>      </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Stack.Types.html#HasCallStack"><span class="hs-identifier hs-type">HasCallStack</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-446"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="annot"><a href="#local-6989586621679616562"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-447"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="annot"><a href="#local-6989586621679616562"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-448"></span><span>      </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="annot"><a href="#local-6989586621679616562"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-449"></span><span>    </span><span id="local-6989586621679616615"><span class="annot"><span class="annottext">mergeUtxoNoOverlap :: HasCallStack =&gt; UTxO era -&gt; UTxO era -&gt; UTxO era
</span><a href="#local-6989586621679616615"><span class="hs-identifier hs-var hs-var">mergeUtxoNoOverlap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span id="local-6989586621679616632"><span class="annot"><span class="annottext">Map (TxIn (EraCrypto era)) (TxOut era)
</span><a href="#local-6989586621679616632"><span class="hs-identifier hs-var">m1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span id="local-6989586621679616633"><span class="annot"><span class="annottext">Map (TxIn (EraCrypto era)) (TxOut era)
</span><a href="#local-6989586621679616633"><span class="hs-identifier hs-var">m2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-450"></span><span>      </span><span class="annot"><span class="annottext">Map (TxIn (EraCrypto era)) (TxOut era) -&gt; UTxO era
forall era. Map (TxIn (EraCrypto era)) (TxOut era) -&gt; UTxO era
</span><span class="hs-identifier hs-var">UTxO</span></span><span> </span><span class="annot"><span class="annottext">(Map (TxIn (EraCrypto era)) (TxOut era) -&gt; UTxO era)
-&gt; Map (TxIn (EraCrypto era)) (TxOut era) -&gt; UTxO era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-451"></span><span>        </span><span class="annot"><span class="annottext">(TxIn (EraCrypto era) -&gt; TxOut era -&gt; TxOut era -&gt; TxOut era)
-&gt; Map (TxIn (EraCrypto era)) (TxOut era)
-&gt; Map (TxIn (EraCrypto era)) (TxOut era)
-&gt; Map (TxIn (EraCrypto era)) (TxOut era)
forall k a.
Ord k =&gt;
(k -&gt; a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.Internal.html#unionWithKey"><span class="hs-identifier hs-var">Map.unionWithKey</span></a></span><span>
</span><span id="line-452"></span><span>          </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679616635"><span class="annot"><span class="annottext">TxIn (EraCrypto era)
</span><a href="#local-6989586621679616635"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TxOut era
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TxOut era
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; TxOut era) -&gt; String -&gt; TxOut era
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;initial fund part of UTxO: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn (EraCrypto era) -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn (EraCrypto era)
</span><a href="#local-6989586621679616635"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>          </span><span class="annot"><span class="annottext">Map (TxIn (EraCrypto era)) (TxOut era)
</span><a href="#local-6989586621679616632"><span class="hs-identifier hs-var">m1</span></a></span><span>
</span><span id="line-454"></span><span>          </span><span class="annot"><span class="annottext">Map (TxIn (EraCrypto era)) (TxOut era)
</span><a href="#local-6989586621679616633"><span class="hs-identifier hs-var">m2</span></a></span><span>
</span><span id="line-455"></span></pre></body></html>