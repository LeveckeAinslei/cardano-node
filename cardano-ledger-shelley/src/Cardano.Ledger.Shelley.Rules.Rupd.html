<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE EmptyDataDeriving #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-orphans #-}</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Ledger.Shelley.Rules.Rupd</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-11"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyRUPD"><span class="hs-identifier">ShelleyRUPD</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RupdEnv"><span class="hs-identifier">RupdEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>  </span><span class="annot"><span class="hs-identifier">PredicateFailure</span></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#ShelleyRupdPredFailure"><span class="hs-identifier">ShelleyRupdPredFailure</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>  </span><span class="annot"><span class="hs-identifier">epochInfoRange</span></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.RewardUpdate.html#PulsingRewUpdate"><span class="hs-identifier">PulsingRewUpdate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.PulsingReward.html#startStep"><span class="hs-identifier">startStep</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.PulsingReward.html#pulseStep"><span class="hs-identifier">pulseStep</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.PulsingReward.html#completeStep"><span class="hs-identifier">completeStep</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier">lift</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Identity.html#Identity"><span class="hs-identifier">Identity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RupdEvent"><span class="hs-identifier">RupdEvent</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">where</span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.BaseTypes</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><span class="hs-identifier">BlocksMade</span></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><span class="hs-identifier">ShelleyBase</span></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><span class="hs-identifier">StrictMaybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><span class="hs-identifier">activeSlotCoeff</span></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><span class="hs-identifier">epochInfoPure</span></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><span class="hs-identifier">maxLovelaceSupply</span></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><span class="hs-identifier">randomnessStabilisationWindow</span></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><span class="hs-identifier">securityParameter</span></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Coin</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Coin</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Core</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Credential</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Credential</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Keys</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">KeyRole</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Staking</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html"><span class="hs-identifier">Cardano.Ledger.Shelley.Era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyRUPD"><span class="hs-identifier">ShelleyRUPD</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Governance.html"><span class="hs-identifier">Cardano.Ledger.Shelley.Governance</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Governance.html#EraGov"><span class="hs-identifier">EraGov</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.html"><span class="hs-identifier">Cardano.Ledger.Shelley.LedgerState</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#EpochState"><span class="hs-identifier">EpochState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.RewardUpdate.html#PulsingRewUpdate"><span class="hs-identifier">PulsingRewUpdate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.PulsingReward.html#completeStep"><span class="hs-identifier">completeStep</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.PulsingReward.html#pulseStep"><span class="hs-identifier">pulseStep</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.PulsingReward.html#startStep"><span class="hs-identifier">startStep</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Slot</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><span class="hs-identifier">Duration</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><span class="hs-identifier">EpochNo</span></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>  </span><span class="annot"><span class="hs-identifier">SlotNo</span></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><span class="hs-identifier">epochInfoEpoch</span></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><span class="hs-identifier">epochInfoFirst</span></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><span class="hs-identifier">epochInfoSize</span></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><span class="hs-operator">(+*)</span></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Slotting.EpochInfo.API</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">epochInfoRange</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/deepseq-1.4.8.1/src/Control.DeepSeq.html"><span class="hs-identifier">Control.DeepSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/deepseq-1.4.8.1/src/Control.DeepSeq.html#NFData"><span class="hs-identifier">NFData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Identity.html"><span class="hs-identifier">Control.Monad.Identity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.Identity.html#Identity"><span class="hs-identifier">Identity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/mtl-2.3.1/src/Control.Monad.Trans.html"><span class="hs-identifier">Control.Monad.Trans</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Class.html#lift"><span class="hs-identifier">lift</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html"><span class="hs-identifier">Control.Monad.Trans.Reader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#asks"><span class="hs-identifier">asks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.State.Transition</span></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><span class="hs-identifier">Rule</span></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><span class="hs-identifier">STS</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><span class="hs-identifier">TRC</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><span class="hs-identifier">TransitionRule</span></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><span class="hs-identifier">judgmentContext</span></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><span class="hs-identifier">liftSTS</span></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><span class="hs-identifier">tellEvent</span></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html"><span class="hs-identifier">Data.Functor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%26%3E"><span class="hs-operator">(&lt;&amp;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Strict.html"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.html"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Generics.html"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">NoThunks.Class</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NoThunks</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">data</span><span> </span><span id="RupdEnv"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RupdEnv"><span class="hs-identifier hs-var">RupdEnv</span></a></span></span><span> </span><span id="local-6989586621679621537"><span class="annot"><a href="#local-6989586621679621537"><span class="hs-identifier hs-type">era</span></a></span></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="RupdEnv"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RupdEnv"><span class="hs-identifier hs-var">RupdEnv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">BlocksMade</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EraCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679621537"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.LedgerState.Types.html#EpochState"><span class="hs-identifier hs-type">EpochState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679621537"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">data</span><span> </span><span id="ShelleyRupdPredFailure"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#ShelleyRupdPredFailure"><span class="hs-identifier hs-var">ShelleyRupdPredFailure</span></a></span></span><span> </span><span id="local-6989586621679621539"><span class="annot"><a href="#local-6989586621679621539"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span class="hs-comment">-- No predicate failures</span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679621541"><span id="local-6989586621679621543"><span id="local-6989586621679621547"><span class="annot"><span class="annottext">Int -&gt; ShelleyRupdPredFailure era -&gt; ShowS
[ShelleyRupdPredFailure era] -&gt; ShowS
ShelleyRupdPredFailure era -&gt; String
(Int -&gt; ShelleyRupdPredFailure era -&gt; ShowS)
-&gt; (ShelleyRupdPredFailure era -&gt; String)
-&gt; ([ShelleyRupdPredFailure era] -&gt; ShowS)
-&gt; Show (ShelleyRupdPredFailure era)
forall era. Int -&gt; ShelleyRupdPredFailure era -&gt; ShowS
forall era. [ShelleyRupdPredFailure era] -&gt; ShowS
forall era. ShelleyRupdPredFailure era -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: forall era. Int -&gt; ShelleyRupdPredFailure era -&gt; ShowS
showsPrec :: Int -&gt; ShelleyRupdPredFailure era -&gt; ShowS
$cshow :: forall era. ShelleyRupdPredFailure era -&gt; String
show :: ShelleyRupdPredFailure era -&gt; String
$cshowList :: forall era. [ShelleyRupdPredFailure era] -&gt; ShowS
showList :: [ShelleyRupdPredFailure era] -&gt; ShowS
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Show.html#Show"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679621551"><span id="local-6989586621679621553"><span class="annot"><span class="annottext">ShelleyRupdPredFailure era -&gt; ShelleyRupdPredFailure era -&gt; Bool
(ShelleyRupdPredFailure era -&gt; ShelleyRupdPredFailure era -&gt; Bool)
-&gt; (ShelleyRupdPredFailure era
    -&gt; ShelleyRupdPredFailure era -&gt; Bool)
-&gt; Eq (ShelleyRupdPredFailure era)
forall era.
ShelleyRupdPredFailure era -&gt; ShelleyRupdPredFailure era -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: forall era.
ShelleyRupdPredFailure era -&gt; ShelleyRupdPredFailure era -&gt; Bool
== :: ShelleyRupdPredFailure era -&gt; ShelleyRupdPredFailure era -&gt; Bool
$c/= :: forall era.
ShelleyRupdPredFailure era -&gt; ShelleyRupdPredFailure era -&gt; Bool
/= :: ShelleyRupdPredFailure era -&gt; ShelleyRupdPredFailure era -&gt; Bool
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#Eq"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679621558"><span id="local-6989586621679621560"><span class="annot"><span class="annottext">(forall x.
 ShelleyRupdPredFailure era -&gt; Rep (ShelleyRupdPredFailure era) x)
-&gt; (forall x.
    Rep (ShelleyRupdPredFailure era) x -&gt; ShelleyRupdPredFailure era)
-&gt; Generic (ShelleyRupdPredFailure era)
forall x.
Rep (ShelleyRupdPredFailure era) x -&gt; ShelleyRupdPredFailure era
forall x.
ShelleyRupdPredFailure era -&gt; Rep (ShelleyRupdPredFailure era) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall era x.
Rep (ShelleyRupdPredFailure era) x -&gt; ShelleyRupdPredFailure era
forall era x.
ShelleyRupdPredFailure era -&gt; Rep (ShelleyRupdPredFailure era) x
$cfrom :: forall era x.
ShelleyRupdPredFailure era -&gt; Rep (ShelleyRupdPredFailure era) x
from :: forall x.
ShelleyRupdPredFailure era -&gt; Rep (ShelleyRupdPredFailure era) x
$cto :: forall era x.
Rep (ShelleyRupdPredFailure era) x -&gt; ShelleyRupdPredFailure era
to :: forall x.
Rep (ShelleyRupdPredFailure era) x -&gt; ShelleyRupdPredFailure era
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Generics.html#Generic"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Generic</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679621400"><span id="local-6989586621679621564"><span id="local-6989586621679621568"><span id="local-6989586621679621574"><span class="annot"><span class="hs-identifier hs-type">NoThunks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#ShelleyRupdPredFailure"><span class="hs-identifier hs-type">ShelleyRupdPredFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679621400"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679621411"><span id="local-6989586621679621592"><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/deepseq-1.4.8.1/src/Control.DeepSeq.html#NFData"><span class="hs-identifier hs-type">NFData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#ShelleyRupdPredFailure"><span class="hs-identifier hs-type">ShelleyRupdPredFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679621411"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">instance</span><span>
</span><span id="line-89"></span><span>  </span><span id="local-6989586621679621430"><span id="local-6989586621679621620"><span id="local-6989586621679621624"><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Era</span></span><span> </span><span class="annot"><a href="#local-6989586621679621430"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Governance.html#EraGov"><span class="hs-identifier hs-type">EraGov</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679621430"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">STS</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyRUPD"><span class="hs-identifier hs-type">ShelleyRUPD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679621430"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-94"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="State"><span class="annot"><span class="hs-identifier hs-var">State</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyRUPD"><span class="hs-identifier hs-type">ShelleyRUPD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679621430"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StrictMaybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.RewardUpdate.html#PulsingRewUpdate"><span class="hs-identifier hs-type">PulsingRewUpdate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EraCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679621430"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Signal"><span class="annot"><span class="hs-identifier hs-var">Signal</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyRUPD"><span class="hs-identifier hs-type">ShelleyRUPD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679621430"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span>
</span><span id="line-96"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Environment"><span class="annot"><span class="hs-identifier hs-var">Environment</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyRUPD"><span class="hs-identifier hs-type">ShelleyRUPD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679621430"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RupdEnv"><span class="hs-identifier hs-type">RupdEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679621430"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="BaseM"><span class="annot"><span class="hs-identifier hs-var">BaseM</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyRUPD"><span class="hs-identifier hs-type">ShelleyRUPD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679621430"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ShelleyBase</span></span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="PredicateFailure"><span class="annot"><span class="hs-identifier hs-var">PredicateFailure</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyRUPD"><span class="hs-identifier hs-type">ShelleyRUPD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679621430"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#ShelleyRupdPredFailure"><span class="hs-identifier hs-type">ShelleyRupdPredFailure</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679621430"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-99"></span><span>  </span><span class="hs-keyword">type</span><span> </span><span id="Event"><span class="annot"><span class="hs-identifier hs-var">Event</span></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyRUPD"><span class="hs-identifier hs-type">ShelleyRUPD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679621430"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RupdEvent"><span class="hs-identifier hs-type">RupdEvent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EraCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679621430"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>  </span><span id="local-6989586621679621633"><span class="annot"><span class="annottext">initialRules :: [InitialRule (ShelleyRUPD era)]
</span><a href="#local-6989586621679621633"><span class="hs-identifier hs-var hs-var hs-var hs-var">initialRules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">StrictMaybe (PulsingRewUpdate (EraCrypto era))
-&gt; F (Clause (ShelleyRUPD era) 'Initial)
     (StrictMaybe (PulsingRewUpdate (EraCrypto era)))
forall a. a -&gt; F (Clause (ShelleyRUPD era) 'Initial) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">StrictMaybe (PulsingRewUpdate (EraCrypto era))
forall a. StrictMaybe a
</span><span class="hs-identifier hs-var">SNothing</span></span><span class="hs-special">]</span><span>
</span><span id="line-102"></span><span>  </span><span id="local-6989586621679621637"><span class="annot"><span class="annottext">transitionRules :: [TransitionRule (ShelleyRUPD era)]
</span><a href="#local-6989586621679621637"><span class="hs-identifier hs-var hs-var hs-var hs-var">transitionRules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TransitionRule (ShelleyRUPD era)
forall era. EraGov era =&gt; TransitionRule (ShelleyRUPD era)
</span><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#rupdTransition"><span class="hs-identifier hs-var">rupdTransition</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-keyword">data</span><span> </span><span id="RupdEvent"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RupdEvent"><span class="hs-identifier hs-var">RupdEvent</span></a></span></span><span> </span><span id="local-6989586621679621511"><span class="annot"><a href="#local-6989586621679621511"><span class="hs-identifier hs-type">c</span></a></span></span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="RupdEvent"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RupdEvent"><span class="hs-identifier hs-var">RupdEvent</span></a></span></span><span>
</span><span id="line-106"></span><span>      </span><span class="hs-glyph">!</span><span class="annot"><span class="hs-identifier hs-type">EpochNo</span></span><span>
</span><span id="line-107"></span><span>      </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Credential</span></span><span> </span><span class="hs-special">'</span><span class="annot"><span class="hs-identifier hs-type">Staking</span></span><span> </span><span class="annot"><a href="#local-6989586621679621511"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reward</span></span><span> </span><span class="annot"><a href="#local-6989586621679621511"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="annot"><span class="hs-comment">-- | tell a RupdEvent only if the map is non-empty</span></span><span>
</span><span id="line-110"></span><span id="local-6989586621679621443"><span id="local-6989586621679621445"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#tellRupd"><span class="hs-identifier hs-type">tellRupd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RupdEvent"><span class="hs-identifier hs-type">RupdEvent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EraCrypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679621443"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rule</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyRUPD"><span class="hs-identifier hs-type">ShelleyRUPD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679621443"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679621445"><span class="hs-identifier hs-type">rtype</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-111"></span><span id="tellRupd"><span class="annot"><span class="annottext">tellRupd :: forall era (rtype :: RuleType).
String
-&gt; RupdEvent (EraCrypto era) -&gt; Rule (ShelleyRUPD era) rtype ()
</span><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#tellRupd"><span class="hs-identifier hs-var hs-var">tellRupd</span></a></span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RupdEvent"><span class="hs-identifier hs-type">RupdEvent</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679621643"><span class="annot"><span class="annottext">Map
  (Credential 'Staking (EraCrypto era))
  (Set (Reward (EraCrypto era)))
</span><a href="#local-6989586621679621643"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Map
  (Credential 'Staking (EraCrypto era))
  (Set (Reward (EraCrypto era)))
-&gt; Bool
forall k a. Map k a -&gt; Bool
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/containers-0.6.7/src/Data.Map.Internal.html#null"><span class="hs-identifier hs-var">Map.null</span></a></span><span> </span><span class="annot"><span class="annottext">Map
  (Credential 'Staking (EraCrypto era))
  (Set (Reward (EraCrypto era)))
</span><a href="#local-6989586621679621643"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; F (Clause (ShelleyRUPD era) rtype) ()
forall a. a -&gt; F (Clause (ShelleyRUPD era) rtype) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#tellRupd"><span class="hs-identifier hs-var">tellRupd</span></a></span><span> </span><span id="local-6989586621679621645"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679621645"><span class="hs-identifier hs-var">_message</span></a></span></span><span> </span><span id="local-6989586621679621646"><span class="annot"><span class="annottext">RupdEvent (EraCrypto era)
</span><a href="#local-6989586621679621646"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Event (ShelleyRUPD era) -&gt; F (Clause (ShelleyRUPD era) rtype) ()
forall sts (ctx :: RuleType). Event sts -&gt; Rule sts ctx ()
</span><span class="hs-identifier hs-var">tellEvent</span></span><span> </span><span class="annot"><span class="annottext">Event (ShelleyRUPD era)
RupdEvent (EraCrypto era)
</span><a href="#local-6989586621679621646"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="annot"><span class="hs-comment">-- | The Goldilocks labeling of when to do the reward calculation.</span></span><span>
</span><span id="line-115"></span><span class="hs-keyword">data</span><span> </span><span id="RewardTiming"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RewardTiming"><span class="hs-identifier hs-var">RewardTiming</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RewardsTooEarly"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RewardsTooEarly"><span class="hs-identifier hs-var">RewardsTooEarly</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="RewardsJustRight"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RewardsJustRight"><span class="hs-identifier hs-var">RewardsJustRight</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="RewardsTooLate"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RewardsTooLate"><span class="hs-identifier hs-var">RewardsTooLate</span></a></span></span><span>
</span><span id="line-116"></span><span>
</span><span id="line-117"></span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#determineRewardTiming"><span class="hs-identifier hs-type">determineRewardTiming</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RewardTiming"><span class="hs-identifier hs-type">RewardTiming</span></a></span><span>
</span><span id="line-118"></span><span id="determineRewardTiming"><span class="annot"><span class="annottext">determineRewardTiming :: SlotNo -&gt; SlotNo -&gt; SlotNo -&gt; RewardTiming
</span><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#determineRewardTiming"><span class="hs-identifier hs-var hs-var">determineRewardTiming</span></a></span></span><span> </span><span id="local-6989586621679621651"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679621651"><span class="hs-identifier hs-var">currentSlot</span></a></span></span><span> </span><span id="local-6989586621679621652"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679621652"><span class="hs-identifier hs-var">startAfterSlot</span></a></span></span><span> </span><span id="local-6989586621679621653"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679621653"><span class="hs-identifier hs-var">endSlot</span></a></span></span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679621651"><span class="hs-identifier hs-var">currentSlot</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3E"><span class="hs-operator hs-var">&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679621653"><span class="hs-identifier hs-var">endSlot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewardTiming
</span><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RewardsTooLate"><span class="hs-identifier hs-var">RewardsTooLate</span></a></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679621651"><span class="hs-identifier hs-var">currentSlot</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/ghc-prim-0.10.0/src/GHC.Classes.html#%3C%3D"><span class="hs-operator hs-var">&lt;=</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679621652"><span class="hs-identifier hs-var">startAfterSlot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewardTiming
</span><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RewardsTooEarly"><span class="hs-identifier hs-var">RewardsTooEarly</span></a></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RewardTiming
</span><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RewardsJustRight"><span class="hs-identifier hs-var">RewardsJustRight</span></a></span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span id="local-6989586621679621441"><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#rupdTransition"><span class="hs-identifier hs-type">rupdTransition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Ledger.Shelley.Governance.html#EraGov"><span class="hs-identifier hs-type">EraGov</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679621441"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TransitionRule</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Era.html#ShelleyRUPD"><span class="hs-identifier hs-type">ShelleyRUPD</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679621441"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-124"></span><span id="rupdTransition"><span class="annot"><span class="annottext">rupdTransition :: forall era. EraGov era =&gt; TransitionRule (ShelleyRUPD era)
</span><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#rupdTransition"><span class="hs-identifier hs-var hs-var">rupdTransition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">TRC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RupdEnv"><span class="hs-identifier hs-type">RupdEnv</span></a></span><span> </span><span id="local-6989586621679621720"><span class="annot"><span class="annottext">BlocksMade (EraCrypto era)
</span><a href="#local-6989586621679621720"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621679621721"><span class="annot"><span class="annottext">EpochState era
</span><a href="#local-6989586621679621721"><span class="hs-identifier hs-var">es</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679621722"><span class="annot"><span class="annottext">State (ShelleyRUPD era)
</span><a href="#local-6989586621679621722"><span class="hs-identifier hs-var">ru</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679621723"><span class="annot"><span class="annottext">Signal (ShelleyRUPD era)
</span><a href="#local-6989586621679621723"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Rule
  (ShelleyRUPD era)
  'Transition
  (RuleContext 'Transition (ShelleyRUPD era))
F (Clause (ShelleyRUPD era) 'Transition) (TRC (ShelleyRUPD era))
forall sts (rtype :: RuleType).
Rule sts rtype (RuleContext rtype sts)
</span><span class="hs-identifier hs-var">judgmentContext</span></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679621724"><span class="annot"><span class="annottext">EpochSize
</span><a href="#local-6989586621679621724"><span class="hs-identifier hs-var">slotsPerEpoch</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679621725"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679621725"><span class="hs-identifier hs-var">slot</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679621726"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679621726"><span class="hs-identifier hs-var">slotForce</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679621727"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679621727"><span class="hs-identifier hs-var">maxLL</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679621728"><span class="annot"><span class="annottext">ActiveSlotCoeff
</span><a href="#local-6989586621679621728"><span class="hs-identifier hs-var">asc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679621729"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679621729"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679621730"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679621730"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BaseM
  (ShelleyRUPD era)
  (EpochSize, SlotNo, SlotNo, Word64, ActiveSlotCoeff, Word64,
   EpochNo)
-&gt; Rule
     (ShelleyRUPD era)
     'Transition
     (EpochSize, SlotNo, SlotNo, Word64, ActiveSlotCoeff, Word64,
      EpochNo)
forall sts a (ctx :: RuleType).
STS sts =&gt;
BaseM sts a -&gt; Rule sts ctx a
</span><span class="hs-identifier hs-var">liftSTS</span></span><span> </span><span class="annot"><span class="annottext">(BaseM
   (ShelleyRUPD era)
   (EpochSize, SlotNo, SlotNo, Word64, ActiveSlotCoeff, Word64,
    EpochNo)
 -&gt; Rule
      (ShelleyRUPD era)
      'Transition
      (EpochSize, SlotNo, SlotNo, Word64, ActiveSlotCoeff, Word64,
       EpochNo))
-&gt; BaseM
     (ShelleyRUPD era)
     (EpochSize, SlotNo, SlotNo, Word64, ActiveSlotCoeff, Word64,
      EpochNo)
-&gt; Rule
     (ShelleyRUPD era)
     'Transition
     (EpochSize, SlotNo, SlotNo, Word64, ActiveSlotCoeff, Word64,
      EpochNo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-127"></span><span>    </span><span id="local-6989586621679621731"><span class="annot"><span class="annottext">EpochInfo Identity
</span><a href="#local-6989586621679621731"><span class="hs-identifier hs-var">ei</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Globals -&gt; EpochInfo Identity)
-&gt; ReaderT Globals Identity (EpochInfo Identity)
forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">Globals -&gt; EpochInfo Identity
</span><span class="hs-identifier hs-var">epochInfoPure</span></span><span>
</span><span id="line-128"></span><span>    </span><span id="local-6989586621679621732"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679621732"><span class="hs-identifier hs-var">sr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Globals -&gt; Word64) -&gt; ReaderT Globals Identity Word64
forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">Globals -&gt; Word64
</span><span class="hs-identifier hs-var">randomnessStabilisationWindow</span></span><span>
</span><span id="line-129"></span><span>    </span><span id="local-6989586621679621733"><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679621733"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; EpochInfo Identity -&gt; SlotNo -&gt; ShelleyBase EpochNo
EpochInfo Identity -&gt; SlotNo -&gt; ShelleyBase EpochNo
</span><span class="hs-identifier hs-var">epochInfoEpoch</span></span><span> </span><span class="annot"><span class="annottext">EpochInfo Identity
</span><a href="#local-6989586621679621731"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
Signal (ShelleyRUPD era)
</span><a href="#local-6989586621679621723"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621679621734"><span class="annot"><span class="annottext">EpochSize
</span><a href="#local-6989586621679621734"><span class="hs-identifier hs-var">slotsPerEpoch</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt;
EpochInfo Identity -&gt; EpochNo -&gt; ShelleyBase EpochSize
EpochInfo Identity -&gt; EpochNo -&gt; ShelleyBase EpochSize
</span><span class="hs-identifier hs-var">epochInfoSize</span></span><span> </span><span class="annot"><span class="annottext">EpochInfo Identity
</span><a href="#local-6989586621679621731"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679621733"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span id="local-6989586621679621735"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679621735"><span class="hs-identifier hs-var">slot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; EpochInfo Identity -&gt; EpochNo -&gt; ShelleyBase SlotNo
EpochInfo Identity -&gt; EpochNo -&gt; ShelleyBase SlotNo
</span><span class="hs-identifier hs-var">epochInfoFirst</span></span><span> </span><span class="annot"><span class="annottext">EpochInfo Identity
</span><a href="#local-6989586621679621731"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679621733"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ShelleyBase SlotNo -&gt; (SlotNo -&gt; SlotNo) -&gt; ShelleyBase SlotNo
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/Data.Functor.html#%3C%26%3E"><span class="hs-operator hs-var">&lt;&amp;&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotNo -&gt; Duration -&gt; SlotNo
</span><span class="hs-operator hs-var">+*</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Duration
</span><span class="hs-identifier hs-var">Duration</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679621732"><span class="hs-identifier hs-var">sr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>    </span><span id="local-6989586621679621737"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679621737"><span class="hs-identifier hs-var">maxLL</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Globals -&gt; Word64) -&gt; ReaderT Globals Identity Word64
forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">Globals -&gt; Word64
</span><span class="hs-identifier hs-var">maxLovelaceSupply</span></span><span>
</span><span id="line-133"></span><span>    </span><span id="local-6989586621679621738"><span class="annot"><span class="annottext">ActiveSlotCoeff
</span><a href="#local-6989586621679621738"><span class="hs-identifier hs-var">asc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Globals -&gt; ActiveSlotCoeff)
-&gt; ReaderT Globals Identity ActiveSlotCoeff
forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">Globals -&gt; ActiveSlotCoeff
</span><span class="hs-identifier hs-var">activeSlotCoeff</span></span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621679621739"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679621739"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Globals -&gt; Word64) -&gt; ReaderT Globals Identity Word64
forall (m :: * -&gt; *) r a. Monad m =&gt; (r -&gt; a) -&gt; ReaderT r m a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/transformers-0.6.1.0/src/Control.Monad.Trans.Reader.html#asks"><span class="hs-identifier hs-var">asks</span></a></span><span> </span><span class="annot"><span class="annottext">Globals -&gt; Word64
</span><span class="hs-identifier hs-var">securityParameter</span></span><span> </span><span class="hs-comment">-- Maximum number of blocks we are allowed to roll back</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><span class="annottext">(EpochSize, SlotNo, SlotNo, Word64, ActiveSlotCoeff, Word64,
 EpochNo)
-&gt; ReaderT
     Globals
     Identity
     (EpochSize, SlotNo, SlotNo, Word64, ActiveSlotCoeff, Word64,
      EpochNo)
forall a. a -&gt; ReaderT Globals Identity a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochSize
</span><a href="#local-6989586621679621734"><span class="hs-identifier hs-var">slotsPerEpoch</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679621735"><span class="hs-identifier hs-var">slot</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679621735"><span class="hs-identifier hs-var">slot</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; Duration -&gt; SlotNo
</span><span class="hs-operator hs-var">+*</span></span><span> </span><span class="annot"><span class="annottext">Word64 -&gt; Duration
</span><span class="hs-identifier hs-var">Duration</span></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679621732"><span class="hs-identifier hs-var">sr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679621737"><span class="hs-identifier hs-var">maxLL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ActiveSlotCoeff
</span><a href="#local-6989586621679621738"><span class="hs-identifier hs-var">asc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679621739"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679621733"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679621740"><span class="annot"><span class="annottext">maxsupply :: Coin
</span><a href="#local-6989586621679621740"><span class="hs-identifier hs-var hs-var">maxsupply</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><span class="hs-identifier hs-var">Coin</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word64 -&gt; Integer
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Real.html#fromIntegral"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679621727"><span class="hs-identifier hs-var">maxLL</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo -&gt; SlotNo -&gt; RewardTiming
</span><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#determineRewardTiming"><span class="hs-identifier hs-var">determineRewardTiming</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
Signal (ShelleyRUPD era)
</span><a href="#local-6989586621679621723"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679621725"><span class="hs-identifier hs-var">slot</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679621726"><span class="hs-identifier hs-var">slotForce</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-comment">-- Waiting for the stability point, do nothing, keep waiting</span><span>
</span><span id="line-139"></span><span>    </span><span class="annot"><span class="annottext">RewardTiming
</span><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RewardsTooEarly"><span class="hs-identifier hs-var">RewardsTooEarly</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StrictMaybe (PulsingRewUpdate (EraCrypto era))
-&gt; F (Clause (ShelleyRUPD era) 'Transition)
     (StrictMaybe (PulsingRewUpdate (EraCrypto era)))
forall a. a -&gt; F (Clause (ShelleyRUPD era) 'Transition) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">StrictMaybe (PulsingRewUpdate (EraCrypto era))
forall a. StrictMaybe a
</span><span class="hs-identifier hs-var">SNothing</span></span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-comment">-- More blocks to come, get things started or take a step</span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><span class="annottext">RewardTiming
</span><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RewardsJustRight"><span class="hs-identifier hs-var">RewardsJustRight</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-142"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">State (ShelleyRUPD era)
</span><a href="#local-6989586621679621722"><span class="hs-identifier hs-var">ru</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-143"></span><span>        </span><span class="annot"><span class="annottext">StrictMaybe (PulsingRewUpdate (EraCrypto era))
State (ShelleyRUPD era)
</span><span class="hs-identifier hs-var">SNothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-144"></span><span>          </span><span class="hs-comment">-- This is the first opportunity to pulse, so start pulsing.</span><span>
</span><span id="line-145"></span><span>          </span><span class="hs-comment">-- SJust &lt;$&gt; tellLeaderEvents (e + 1) (fst (startStep slotsPerEpoch b es maxsupply asc k))</span><span>
</span><span id="line-146"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StrictMaybe (PulsingRewUpdate (EraCrypto era))
-&gt; F (Clause (ShelleyRUPD era) 'Transition)
     (StrictMaybe (PulsingRewUpdate (EraCrypto era)))
forall a. a -&gt; F (Clause (ShelleyRUPD era) 'Transition) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(StrictMaybe (PulsingRewUpdate (EraCrypto era))
 -&gt; F (Clause (ShelleyRUPD era) 'Transition)
      (StrictMaybe (PulsingRewUpdate (EraCrypto era))))
-&gt; (PulsingRewUpdate (EraCrypto era)
    -&gt; StrictMaybe (PulsingRewUpdate (EraCrypto era)))
-&gt; PulsingRewUpdate (EraCrypto era)
-&gt; F (Clause (ShelleyRUPD era) 'Transition)
     (StrictMaybe (PulsingRewUpdate (EraCrypto era)))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
-&gt; StrictMaybe (PulsingRewUpdate (EraCrypto era))
forall a. a -&gt; StrictMaybe a
</span><span class="hs-identifier hs-var">SJust</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochSize
-&gt; BlocksMade (EraCrypto era)
-&gt; EpochState era
-&gt; Coin
-&gt; ActiveSlotCoeff
-&gt; Word64
-&gt; PulsingRewUpdate (EraCrypto era)
forall era.
EraGov era =&gt;
EpochSize
-&gt; BlocksMade (EraCrypto era)
-&gt; EpochState era
-&gt; Coin
-&gt; ActiveSlotCoeff
-&gt; Word64
-&gt; PulsingRewUpdate (EraCrypto era)
</span><a href="Cardano.Ledger.Shelley.LedgerState.PulsingReward.html#startStep"><span class="hs-identifier hs-var">startStep</span></a></span><span> </span><span class="annot"><span class="annottext">EpochSize
</span><a href="#local-6989586621679621724"><span class="hs-identifier hs-var">slotsPerEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">BlocksMade (EraCrypto era)
</span><a href="#local-6989586621679621720"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">EpochState era
</span><a href="#local-6989586621679621721"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679621740"><span class="hs-identifier hs-var">maxsupply</span></a></span><span> </span><span class="annot"><span class="annottext">ActiveSlotCoeff
</span><a href="#local-6989586621679621728"><span class="hs-identifier hs-var">asc</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679621729"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SJust</span></span><span> </span><span id="local-6989586621679621744"><span class="annot"><span class="annottext">p :: PulsingRewUpdate (EraCrypto era)
</span><a href="#local-6989586621679621744"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.RewardUpdate.html#Pulsing"><span class="hs-identifier hs-type">Pulsing</span></a></span><span> </span><span class="annot"><span class="annottext">RewardSnapShot (EraCrypto era)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Pulser (EraCrypto era)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-148"></span><span>          </span><span class="hs-comment">-- We began pulsing earlier, so run another pulse</span><span>
</span><span id="line-149"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679621746"><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
</span><a href="#local-6989586621679621746"><span class="hs-identifier hs-var">ans</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679621747"><span class="annot"><span class="annottext">Map
  (Credential 'Staking (EraCrypto era))
  (Set (Reward (EraCrypto era)))
</span><a href="#local-6989586621679621747"><span class="hs-identifier hs-var">event</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">BaseM
  (ShelleyRUPD era)
  (PulsingRewUpdate (EraCrypto era),
   Map
     (Credential 'Staking (EraCrypto era))
     (Set (Reward (EraCrypto era))))
-&gt; Rule
     (ShelleyRUPD era)
     'Transition
     (PulsingRewUpdate (EraCrypto era),
      Map
        (Credential 'Staking (EraCrypto era))
        (Set (Reward (EraCrypto era))))
forall sts a (ctx :: RuleType).
STS sts =&gt;
BaseM sts a -&gt; Rule sts ctx a
</span><span class="hs-identifier hs-var">liftSTS</span></span><span> </span><span class="annot"><span class="annottext">(BaseM
   (ShelleyRUPD era)
   (PulsingRewUpdate (EraCrypto era),
    Map
      (Credential 'Staking (EraCrypto era))
      (Set (Reward (EraCrypto era))))
 -&gt; Rule
      (ShelleyRUPD era)
      'Transition
      (PulsingRewUpdate (EraCrypto era),
       Map
         (Credential 'Staking (EraCrypto era))
         (Set (Reward (EraCrypto era)))))
-&gt; BaseM
     (ShelleyRUPD era)
     (PulsingRewUpdate (EraCrypto era),
      Map
        (Credential 'Staking (EraCrypto era))
        (Set (Reward (EraCrypto era))))
-&gt; Rule
     (ShelleyRUPD era)
     'Transition
     (PulsingRewUpdate (EraCrypto era),
      Map
        (Credential 'Staking (EraCrypto era))
        (Set (Reward (EraCrypto era))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
-&gt; ShelleyBase
     (PulsingRewUpdate (EraCrypto era),
      Map
        (Credential 'Staking (EraCrypto era))
        (Set (Reward (EraCrypto era))))
forall c.
PulsingRewUpdate c
-&gt; ShelleyBase (PulsingRewUpdate c, RewardEvent c)
</span><a href="Cardano.Ledger.Shelley.LedgerState.PulsingReward.html#pulseStep"><span class="hs-identifier hs-var">pulseStep</span></a></span><span> </span><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
</span><a href="#local-6989586621679621744"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-150"></span><span>          </span><span class="annot"><span class="annottext">String
-&gt; RupdEvent (EraCrypto era)
-&gt; Rule (ShelleyRUPD era) 'Transition ()
forall era (rtype :: RuleType).
String
-&gt; RupdEvent (EraCrypto era) -&gt; Rule (ShelleyRUPD era) rtype ()
</span><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#tellRupd"><span class="hs-identifier hs-var">tellRupd</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Pulsing Rupd&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo
-&gt; Map
     (Credential 'Staking (EraCrypto era))
     (Set (Reward (EraCrypto era)))
-&gt; RupdEvent (EraCrypto era)
forall c.
EpochNo
-&gt; Map (Credential 'Staking c) (Set (Reward c)) -&gt; RupdEvent c
</span><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RupdEvent"><span class="hs-identifier hs-var">RupdEvent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679621730"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo -&gt; EpochNo
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map
  (Credential 'Staking (EraCrypto era))
  (Set (Reward (EraCrypto era)))
</span><a href="#local-6989586621679621747"><span class="hs-identifier hs-var">event</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>          </span><span class="annot"><span class="annottext">StrictMaybe (PulsingRewUpdate (EraCrypto era))
-&gt; F (Clause (ShelleyRUPD era) 'Transition)
     (StrictMaybe (PulsingRewUpdate (EraCrypto era)))
forall a. a -&gt; F (Clause (ShelleyRUPD era) 'Transition) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
-&gt; StrictMaybe (PulsingRewUpdate (EraCrypto era))
forall a. a -&gt; StrictMaybe a
</span><span class="hs-identifier hs-var">SJust</span></span><span> </span><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
</span><a href="#local-6989586621679621746"><span class="hs-identifier hs-var">ans</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SJust</span></span><span> </span><span id="local-6989586621679621749"><span class="annot"><span class="annottext">p :: PulsingRewUpdate (EraCrypto era)
</span><a href="#local-6989586621679621749"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.RewardUpdate.html#Complete"><span class="hs-identifier hs-type">Complete</span></a></span><span> </span><span class="annot"><span class="annottext">RewardUpdate (EraCrypto era)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StrictMaybe (PulsingRewUpdate (EraCrypto era))
-&gt; F (Clause (ShelleyRUPD era) 'Transition)
     (StrictMaybe (PulsingRewUpdate (EraCrypto era)))
forall a. a -&gt; F (Clause (ShelleyRUPD era) 'Transition) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
-&gt; StrictMaybe (PulsingRewUpdate (EraCrypto era))
forall a. a -&gt; StrictMaybe a
</span><span class="hs-identifier hs-var">SJust</span></span><span> </span><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
</span><a href="#local-6989586621679621749"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-comment">-- Time to force the completion of the pulser so that downstream tools such as db-sync</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-comment">-- have time to see the reward update before the epoch boundary rollover.</span><span>
</span><span id="line-155"></span><span>    </span><span class="annot"><span class="annottext">RewardTiming
</span><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RewardsTooLate"><span class="hs-identifier hs-var">RewardsTooLate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-156"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">State (ShelleyRUPD era)
</span><a href="#local-6989586621679621722"><span class="hs-identifier hs-var">ru</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-157"></span><span>        </span><span class="annot"><span class="annottext">StrictMaybe (PulsingRewUpdate (EraCrypto era))
State (ShelleyRUPD era)
</span><span class="hs-identifier hs-var">SNothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-158"></span><span>          </span><span class="hs-comment">-- Nothing has been done, so start, and then complete the pulser. We hope this is very rare.</span><span>
</span><span id="line-159"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679621751"><span class="annot"><span class="annottext">pulser :: PulsingRewUpdate (EraCrypto era)
</span><a href="#local-6989586621679621751"><span class="hs-identifier hs-var hs-var">pulser</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EpochSize
-&gt; BlocksMade (EraCrypto era)
-&gt; EpochState era
-&gt; Coin
-&gt; ActiveSlotCoeff
-&gt; Word64
-&gt; PulsingRewUpdate (EraCrypto era)
forall era.
EraGov era =&gt;
EpochSize
-&gt; BlocksMade (EraCrypto era)
-&gt; EpochState era
-&gt; Coin
-&gt; ActiveSlotCoeff
-&gt; Word64
-&gt; PulsingRewUpdate (EraCrypto era)
</span><a href="Cardano.Ledger.Shelley.LedgerState.PulsingReward.html#startStep"><span class="hs-identifier hs-var">startStep</span></a></span><span> </span><span class="annot"><span class="annottext">EpochSize
</span><a href="#local-6989586621679621724"><span class="hs-identifier hs-var">slotsPerEpoch</span></a></span><span> </span><span class="annot"><span class="annottext">BlocksMade (EraCrypto era)
</span><a href="#local-6989586621679621720"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">EpochState era
</span><a href="#local-6989586621679621721"><span class="hs-identifier hs-var">es</span></a></span><span> </span><span class="annot"><span class="annottext">Coin
</span><a href="#local-6989586621679621740"><span class="hs-identifier hs-var">maxsupply</span></a></span><span> </span><span class="annot"><span class="annottext">ActiveSlotCoeff
</span><a href="#local-6989586621679621728"><span class="hs-identifier hs-var">asc</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679621729"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-160"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679621752"><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
</span><a href="#local-6989586621679621752"><span class="hs-identifier hs-var">reward</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679621753"><span class="annot"><span class="annottext">Map
  (Credential 'Staking (EraCrypto era))
  (Set (Reward (EraCrypto era)))
</span><a href="#local-6989586621679621753"><span class="hs-identifier hs-var">event</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShelleyBase
  (PulsingRewUpdate (EraCrypto era),
   Map
     (Credential 'Staking (EraCrypto era))
     (Set (Reward (EraCrypto era))))
-&gt; Rule
     (ShelleyRUPD era)
     'Transition
     (PulsingRewUpdate (EraCrypto era),
      Map
        (Credential 'Staking (EraCrypto era))
        (Set (Reward (EraCrypto era))))
BaseM
  (ShelleyRUPD era)
  (PulsingRewUpdate (EraCrypto era),
   Map
     (Credential 'Staking (EraCrypto era))
     (Set (Reward (EraCrypto era))))
-&gt; Rule
     (ShelleyRUPD era)
     'Transition
     (PulsingRewUpdate (EraCrypto era),
      Map
        (Credential 'Staking (EraCrypto era))
        (Set (Reward (EraCrypto era))))
forall sts a (ctx :: RuleType).
STS sts =&gt;
BaseM sts a -&gt; Rule sts ctx a
</span><span class="hs-identifier hs-var">liftSTS</span></span><span> </span><span class="annot"><span class="annottext">(ShelleyBase
   (PulsingRewUpdate (EraCrypto era),
    Map
      (Credential 'Staking (EraCrypto era))
      (Set (Reward (EraCrypto era))))
 -&gt; Rule
      (ShelleyRUPD era)
      'Transition
      (PulsingRewUpdate (EraCrypto era),
       Map
         (Credential 'Staking (EraCrypto era))
         (Set (Reward (EraCrypto era)))))
-&gt; (PulsingRewUpdate (EraCrypto era)
    -&gt; ShelleyBase
         (PulsingRewUpdate (EraCrypto era),
          Map
            (Credential 'Staking (EraCrypto era))
            (Set (Reward (EraCrypto era)))))
-&gt; PulsingRewUpdate (EraCrypto era)
-&gt; Rule
     (ShelleyRUPD era)
     'Transition
     (PulsingRewUpdate (EraCrypto era),
      Map
        (Credential 'Staking (EraCrypto era))
        (Set (Reward (EraCrypto era))))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
-&gt; ShelleyBase
     (PulsingRewUpdate (EraCrypto era),
      Map
        (Credential 'Staking (EraCrypto era))
        (Set (Reward (EraCrypto era))))
forall c.
PulsingRewUpdate c
-&gt; ShelleyBase (PulsingRewUpdate c, RewardEvent c)
</span><a href="Cardano.Ledger.Shelley.LedgerState.PulsingReward.html#completeStep"><span class="hs-identifier hs-var">completeStep</span></a></span><span> </span><span class="annot"><span class="annottext">(PulsingRewUpdate (EraCrypto era)
 -&gt; Rule
      (ShelleyRUPD era)
      'Transition
      (PulsingRewUpdate (EraCrypto era),
       Map
         (Credential 'Staking (EraCrypto era))
         (Set (Reward (EraCrypto era)))))
-&gt; PulsingRewUpdate (EraCrypto era)
-&gt; Rule
     (ShelleyRUPD era)
     'Transition
     (PulsingRewUpdate (EraCrypto era),
      Map
        (Credential 'Staking (EraCrypto era))
        (Set (Reward (EraCrypto era))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
</span><a href="#local-6989586621679621751"><span class="hs-identifier hs-var">pulser</span></a></span><span>
</span><span id="line-161"></span><span>          </span><span class="annot"><span class="annottext">String
-&gt; RupdEvent (EraCrypto era)
-&gt; Rule (ShelleyRUPD era) 'Transition ()
forall era (rtype :: RuleType).
String
-&gt; RupdEvent (EraCrypto era) -&gt; Rule (ShelleyRUPD era) rtype ()
</span><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#tellRupd"><span class="hs-identifier hs-var">tellRupd</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Starting too late&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo
-&gt; Map
     (Credential 'Staking (EraCrypto era))
     (Set (Reward (EraCrypto era)))
-&gt; RupdEvent (EraCrypto era)
forall c.
EpochNo
-&gt; Map (Credential 'Staking c) (Set (Reward c)) -&gt; RupdEvent c
</span><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RupdEvent"><span class="hs-identifier hs-var">RupdEvent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679621730"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo -&gt; EpochNo
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map
  (Credential 'Staking (EraCrypto era))
  (Set (Reward (EraCrypto era)))
</span><a href="#local-6989586621679621753"><span class="hs-identifier hs-var">event</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>          </span><span class="annot"><span class="annottext">StrictMaybe (PulsingRewUpdate (EraCrypto era))
-&gt; F (Clause (ShelleyRUPD era) 'Transition)
     (StrictMaybe (PulsingRewUpdate (EraCrypto era)))
forall a. a -&gt; F (Clause (ShelleyRUPD era) 'Transition) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
-&gt; StrictMaybe (PulsingRewUpdate (EraCrypto era))
forall a. a -&gt; StrictMaybe a
</span><span class="hs-identifier hs-var">SJust</span></span><span> </span><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
</span><a href="#local-6989586621679621752"><span class="hs-identifier hs-var">reward</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">SJust</span></span><span> </span><span id="local-6989586621679621754"><span class="annot"><span class="annottext">p :: PulsingRewUpdate (EraCrypto era)
</span><a href="#local-6989586621679621754"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.RewardUpdate.html#Pulsing"><span class="hs-identifier hs-type">Pulsing</span></a></span><span> </span><span class="annot"><span class="annottext">RewardSnapShot (EraCrypto era)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Pulser (EraCrypto era)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-164"></span><span>          </span><span class="hs-comment">-- We have been pulsing, but we ran out of time, so complete the pulser.</span><span>
</span><span id="line-165"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679621755"><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
</span><a href="#local-6989586621679621755"><span class="hs-identifier hs-var">reward</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679621756"><span class="annot"><span class="annottext">Map
  (Credential 'Staking (EraCrypto era))
  (Set (Reward (EraCrypto era)))
</span><a href="#local-6989586621679621756"><span class="hs-identifier hs-var">event</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ShelleyBase
  (PulsingRewUpdate (EraCrypto era),
   Map
     (Credential 'Staking (EraCrypto era))
     (Set (Reward (EraCrypto era))))
-&gt; Rule
     (ShelleyRUPD era)
     'Transition
     (PulsingRewUpdate (EraCrypto era),
      Map
        (Credential 'Staking (EraCrypto era))
        (Set (Reward (EraCrypto era))))
BaseM
  (ShelleyRUPD era)
  (PulsingRewUpdate (EraCrypto era),
   Map
     (Credential 'Staking (EraCrypto era))
     (Set (Reward (EraCrypto era))))
-&gt; Rule
     (ShelleyRUPD era)
     'Transition
     (PulsingRewUpdate (EraCrypto era),
      Map
        (Credential 'Staking (EraCrypto era))
        (Set (Reward (EraCrypto era))))
forall sts a (ctx :: RuleType).
STS sts =&gt;
BaseM sts a -&gt; Rule sts ctx a
</span><span class="hs-identifier hs-var">liftSTS</span></span><span> </span><span class="annot"><span class="annottext">(ShelleyBase
   (PulsingRewUpdate (EraCrypto era),
    Map
      (Credential 'Staking (EraCrypto era))
      (Set (Reward (EraCrypto era))))
 -&gt; Rule
      (ShelleyRUPD era)
      'Transition
      (PulsingRewUpdate (EraCrypto era),
       Map
         (Credential 'Staking (EraCrypto era))
         (Set (Reward (EraCrypto era)))))
-&gt; (PulsingRewUpdate (EraCrypto era)
    -&gt; ShelleyBase
         (PulsingRewUpdate (EraCrypto era),
          Map
            (Credential 'Staking (EraCrypto era))
            (Set (Reward (EraCrypto era)))))
-&gt; PulsingRewUpdate (EraCrypto era)
-&gt; Rule
     (ShelleyRUPD era)
     'Transition
     (PulsingRewUpdate (EraCrypto era),
      Map
        (Credential 'Staking (EraCrypto era))
        (Set (Reward (EraCrypto era))))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
-&gt; ShelleyBase
     (PulsingRewUpdate (EraCrypto era),
      Map
        (Credential 'Staking (EraCrypto era))
        (Set (Reward (EraCrypto era))))
forall c.
PulsingRewUpdate c
-&gt; ShelleyBase (PulsingRewUpdate c, RewardEvent c)
</span><a href="Cardano.Ledger.Shelley.LedgerState.PulsingReward.html#completeStep"><span class="hs-identifier hs-var">completeStep</span></a></span><span> </span><span class="annot"><span class="annottext">(PulsingRewUpdate (EraCrypto era)
 -&gt; Rule
      (ShelleyRUPD era)
      'Transition
      (PulsingRewUpdate (EraCrypto era),
       Map
         (Credential 'Staking (EraCrypto era))
         (Set (Reward (EraCrypto era)))))
-&gt; PulsingRewUpdate (EraCrypto era)
-&gt; Rule
     (ShelleyRUPD era)
     'Transition
     (PulsingRewUpdate (EraCrypto era),
      Map
        (Credential 'Staking (EraCrypto era))
        (Set (Reward (EraCrypto era))))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
</span><a href="#local-6989586621679621754"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-166"></span><span>          </span><span class="annot"><span class="annottext">String
-&gt; RupdEvent (EraCrypto era)
-&gt; Rule (ShelleyRUPD era) 'Transition ()
forall era (rtype :: RuleType).
String
-&gt; RupdEvent (EraCrypto era) -&gt; Rule (ShelleyRUPD era) rtype ()
</span><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#tellRupd"><span class="hs-identifier hs-var">tellRupd</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;completing too late&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo
-&gt; Map
     (Credential 'Staking (EraCrypto era))
     (Set (Reward (EraCrypto era)))
-&gt; RupdEvent (EraCrypto era)
forall c.
EpochNo
-&gt; Map (Credential 'Staking c) (Set (Reward c)) -&gt; RupdEvent c
</span><a href="Cardano.Ledger.Shelley.Rules.Rupd.html#RupdEvent"><span class="hs-identifier hs-var">RupdEvent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EpochNo
</span><a href="#local-6989586621679621730"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo -&gt; EpochNo -&gt; EpochNo
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">EpochNo
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map
  (Credential 'Staking (EraCrypto era))
  (Set (Reward (EraCrypto era)))
</span><a href="#local-6989586621679621756"><span class="hs-identifier hs-var">event</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>          </span><span class="annot"><span class="annottext">StrictMaybe (PulsingRewUpdate (EraCrypto era))
-&gt; F (Clause (ShelleyRUPD era) 'Transition)
     (StrictMaybe (PulsingRewUpdate (EraCrypto era)))
forall a. a -&gt; F (Clause (ShelleyRUPD era) 'Transition) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
-&gt; StrictMaybe (PulsingRewUpdate (EraCrypto era))
forall a. a -&gt; StrictMaybe a
</span><span class="hs-identifier hs-var">SJust</span></span><span> </span><span class="annot"><span class="annottext">PulsingRewUpdate (EraCrypto era)
</span><a href="#local-6989586621679621755"><span class="hs-identifier hs-var">reward</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>        </span><span id="local-6989586621679621757"><span class="annot"><span class="annottext">complete :: State (ShelleyRUPD era)
</span><a href="#local-6989586621679621757"><span class="hs-identifier hs-var">complete</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Ledger.Shelley.RewardUpdate.html#Complete"><span class="hs-identifier hs-type">Complete</span></a></span><span> </span><span class="annot"><span class="annottext">RewardUpdate (EraCrypto era)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StrictMaybe (PulsingRewUpdate (EraCrypto era))
-&gt; F (Clause (ShelleyRUPD era) 'Transition)
     (StrictMaybe (PulsingRewUpdate (EraCrypto era)))
forall a. a -&gt; F (Clause (ShelleyRUPD era) 'Transition) a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="file:///nix/store/iq1rbfvif2j9czimi3xf9cqxpanh5494-ghc-9.6.3-doc/share/doc/ghc-9.6.3/html/libraries/base-4.18.1.0/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">StrictMaybe (PulsingRewUpdate (EraCrypto era))
State (ShelleyRUPD era)
</span><a href="#local-6989586621679621757"><span class="hs-identifier hs-var">complete</span></a></span><span>
</span><span id="line-169"></span></pre></body></html>